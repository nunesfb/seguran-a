# üîπ O que √© Malware?

**Malware** vem do termo *"Malicious Software"* (software malicioso).  

√â qualquer programa, c√≥digo ou arquivo criado com o objetivo de **danificar sistemas, roubar informa√ß√µes, comprometer a privacidade, extorquir valores ou causar indisponibilidade de servi√ßos**.  

Ele se diferencia de softwares leg√≠timos porque √© intencionalmente projetado para causar preju√≠zo ou obter vantagem il√≠cita sobre o usu√°rio ou a organiza√ß√£o.  

---

## üî∏ Caracter√≠sticas principais
- **Inten√ß√£o maliciosa:** diferente de um bug acidental, o malware √© programado para causar dano ou explora√ß√£o.  
- **Diversas formas:** pode vir em arquivos, scripts, macros, execut√°veis, at√© mesmo embutido em hardware ou firmware.  
- **Meios de propaga√ß√£o:** redes sociais, anexos de e-mail, links maliciosos, vulnerabilidades em softwares, dispositivos USB, aplicativos falsos, entre outros.  
- **Efeitos comuns:** roubo de dados, espionagem, lentid√£o do sistema, perda de arquivos, instala√ß√£o de backdoors, sequestro de dados (ransomware).  

---

## üî∏ Objetivos do Malware
- **Financeiros:** fraudes banc√°rias, ransomware, minera√ß√£o de criptomoedas.  
- **Espionagem:** coleta de dados pessoais, corporativos ou governamentais.  
- **Sabotagem:** derrubar sistemas cr√≠ticos ou causar indisponibilidade.  
- **Controle:** transformar m√°quinas em bots para redes de ataques coordenados (botnets).  
- **Engenharia social:** manipular o usu√°rio para instalar softwares falsos ou liberar acesso.  

---

## üî∏ Exemplos pr√°ticos de infec√ß√£o
- Um e-mail com anexo ‚Äúnota fiscal‚Äù que, ao ser aberto, instala um trojan.  
- Um site comprometido que for√ßa o download de spyware.  
- Um pen drive infectado que instala um worm automaticamente.  
- Um aplicativo falso na loja de apps que funciona como adware ou keylogger.  

**Em resumo:** todo v√≠rus √© um malware, mas nem todo malware √© um v√≠rus.  
O termo **malware** √© o ‚Äúguarda-chuva‚Äù que engloba **v√≠rus, worms, trojans, ransomware, spyware, adware, rootkits, keyloggers, backdoors**, entre outros.  

---

# ü¶† V√≠rus

## O que √©
Um v√≠rus √© um tipo de malware que precisa de um hospedeiro (arquivo, setor de boot ou documento com macro) para replicar-se.  
Ele executa quando o hospedeiro √© aberto/executado, tenta infectar outros alvos e, opcionalmente, executa um payload (desde mensagem trivial at√© sabotagem).

---

## Ciclo de Vida (Conceitual)

- **Execu√ß√£o inicial**: o c√≥digo √© acionado junto do arquivo hospedeiro (ex.: usu√°rio abre o arquivo).  
- **Infec√ß√£o/replica√ß√£o**: procura outros alvos compat√≠veis (arquivos do mesmo formato, documentos, etc.) e injeta uma c√≥pia modificada de si.  
- **Persist√™ncia & evas√£o**: tenta permanecer ativo (chaves de inicializa√ß√£o, tarefas agendadas) e esconder-se (empacotadores, t√©cnicas polim√≥rficas/metam√≥rficas).  
- **Ativa√ß√£o do payload**: com base em um gatilho (data, contagem de execu√ß√µes, presen√ßa de internet), realiza a√ß√µes planejadas.  
- **Propaga√ß√£o indireta**: a c√≥pia ‚Äúviaja‚Äù quando o arquivo infectado √© compartilhado (e-mail, USB, rede, nuvem).

---

## Principais Variantes (Alto N√≠vel)

- **File infector**: injeta c√≥digo em execut√°veis/documentos.  
- **Macro v√≠rus**: usa macros (ex.: Office) contidas em documentos.  
- **Boot/MBR**: altera componentes de inicializa√ß√£o do sistema.  
- **Polim√≥rfico/Metam√≥rfico**: muda sua ‚Äúforma‚Äù a cada c√≥pia para dificultar assinaturas.  
  - Polim√≥rfico: cifra/embaralha.  
  - Metam√≥rfico: reescreve partes do pr√≥prio c√≥digo.

---

## Canais de Entrada Mais Comuns

- **Engenharia social**: anexos e links de phishing, ‚Äúatualizadores‚Äù e cracks.  
- **M√≠dia remov√≠vel**: USBs e imagens ISO trocadas entre m√°quinas.  
- **Superf√≠cies expostas**: servi√ßos desatualizados, permiss√µes frouxas, macros habilitadas por padr√£o.

---

## Linguagens (Contexto Neutro)

Malwares j√° foram observados em diversas linguagens de prop√≥sito geral (C/C++, C#, Go, Rust, Python) e scripting (VBScript, JavaScript/macros).  
**Ponto did√°tico**: n√£o √© a linguagem que ‚Äúfaz o v√≠rus‚Äù, e sim o comportamento (replicar-se via hospedeiro + executar payload).

---

## IoCs (Indicadores de Comprometimento)

- Arquivos alterados (tamanho/hash divergentes).  
- Macros inesperadas em documentos.  
- Chaves de inicializa√ß√£o/tarefas desconhecidas.  
- Alertas heur√≠sticos do antimalware; travamentos ao abrir certos arquivos.

---

## Mitiga√ß√£o & Resposta

- Desabilitar macros por padr√£o; somente assinar e habilitar quando necess√°rio.  
- Antimalware/EDR com heur√≠stica e bloqueio comportamental.  
- Varredura em **Modo Seguro** e restaura√ß√£o a partir de backups limpos (regra 3-2-1).  
- Allowlisting (AppLocker/WDAC) e bloqueio de autorun em m√≠dias.  
- Treinamento contra phishing/engenharia social.

---

## Demos 100% Seguras para Sala (Sem Malware)

Objetivo: **mostrar conceitos** (replica√ß√£o, detec√ß√£o, confidencialidade) **sem criar algo perigoso**.

### 1) Integridade de arquivos com hash (SHA-256)
Demonstra que pequenas mudan√ßas no arquivo geram hash totalmente diferente.  
Exemplo em PowerShell:

```powershell
"Ol√°, mundo!" | Out-File -Encoding utf8 exemplo.txt
Get-FileHash .\exemplo.txt -Algorithm SHA256
"Linha adicionada." | Add-Content .\exemplo.txt
Get-FileHash .\exemplo.txt -Algorithm SHA256
```

---

### 2) EICAR ‚Äì teste seguro de antiv√≠rus
Arquivo benigno que dispara o antiv√≠rus de prop√≥sito.

```text
X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
```

Salve como `eicar.txt`. Seu antiv√≠rus deve sinalizar.  
‚ö†Ô∏è **Cuidados**: n√£o enviar por e-mail/nuvem institucional.

---

### 3) Mini-lab de Criptografia em Mem√≥ria (AES-GCM)
Exemplo em Python com `cryptography`:

```python
from cryptography.hazmat.primitives.ciphers.aead import AESGCM
# Exemplo seguro que cifra/decifra apenas texto em mem√≥ria
```

Mostra: sal + PBKDF2 + nonce + AEAD ‚Üí confidencialidade e integridade.

---

### 4) Macro Segura (Somente com Clique)
Exemplo simples em Excel/Word:

```vba
Sub ExibirAvisoDidatico()
    MsgBox "DEMO segura: macros podem executar a√ß√µes quando o usu√°rio clica." & vbCrLf & _
           "Em ambiente real, mantenha macros desabilitadas por padr√£o.", vbInformation, "DEMO Macro"
End Sub
```

---

### 5) Pasta com Senha (7-Zip)
Demonstra prote√ß√£o de dados sem risco:

```bash
7z a -t7z LAB_ENCRIPTADO.7z ./LAB_SEGURO/* -pSenhaDidatica123! -mhe=on
```

- `-p`: senha  
- `-mhe=on`: oculta at√© os nomes dos arquivos

---

# ü™± Worms ‚Äî Vis√£o Did√°tica

## O que √©
Um **worm** √© um malware capaz de **se auto-propagar** pela rede **sem intera√ß√£o do usu√°rio**, explorando **falhas de servi√ßos**, **credenciais fracas** ou **m√° configura√ß√£o**. Diferente do v√≠rus, o worm n√£o precisa de um arquivo hospedeiro: ele **escaneia**, **explora** e **se replica** autonomamente, podendo ainda carregar **payloads** (ex.: minerador, ransomware).

---

## Ciclo de Vida (Conceitual)

- **Ponto inicial**: comprometimento de um host (ex.: servi√ßo exposto vulner√°vel ou RDP com senha fraca).  
- **Descoberta/scan**: varre endere√ßos e portas para **identificar alvos** com o mesmo ponto fraco.  
- **Explora√ß√£o & queda de payload**: usa a falha para ganhar execu√ß√£o remota e **implanta** seu componente.  
- **Replica√ß√£o**: o novo host comprometido **repete o processo** (efeito cascata).  
- **Persist√™ncia/controle (opcional)**: cria servi√ßo/tarefa, ajusta chaves de inicializa√ß√£o e, √†s vezes, contata C2.  
- **A√ß√£o/payload**: criptominera√ß√£o, DDoS, exfiltra√ß√£o ou ‚Äúworm-ransomware‚Äù (ex.: casos ‚Äúworm√°veis‚Äù).

---

## Principais Variantes (Alto N√≠vel)

- **Network worms**: exploram **servi√ßos de rede** (SMB/RPC/HTTP/RDP) para se espalhar.  
- **E-mail/IM worms (hist√≥ricos)**: usam cat√°logos de contatos para enviar c√≥pias de si mesmos.  
- **USB/Removable worms**: propaga√ß√£o por **m√≠dias remov√≠veis** e autorun (ou falhas de atalho/LNK).  
- **IoT worms**: miram dispositivos com **senhas padr√£o** e servi√ßos expostos (ex.: Telnet/HTTP).  
- **Worm-ransomware**: combina√ß√£o de propaga√ß√£o autom√°tica + criptografia de arquivos.  

---

## Canais de Entrada Mais Comuns

- **Servi√ßos expostos** sem patch (SMB, RDP, HTTP, bases de dados).  
- **Credenciais fracas** ou reutilizadas (brute force/credential stuffing).  
- **IoT desatualizado** com senhas de f√°brica.  
- **Compartilhamentos internos** permissivos e redes planas (sem segmenta√ß√£o).

---

## Linguagens (Contexto Neutro)
Worms j√° foram observados em **C/C++** (baixo n√≠vel, sockets), **Go/Rust** (bin√°rios est√°ticos, multiplataforma) e **scripts** como **PowerShell**/Python (automa√ß√£o em ambientes Windows/Linux). **Ponto did√°tico**: a linguagem n√£o define a amea√ßa ‚Äî o **comportamento auto-propagante** √© o essencial.

---

## IoCs (Indicadores de Comprometimento)

- **Picos de varredura** (muitos destinos/portas em curto intervalo).  
- **Aumentos de falhas de autentica√ß√£o** e cria√ß√£o de contas/servi√ßos inesperados.  
- **Conex√µes laterais incomuns** (leste-oeste) e novos **processos em massa**.  
- **Altera√ß√µes de firewall/registro** e **tarefas agendadas** rec√©m-criadas.  

---

## Mitiga√ß√£o & Resposta

- **Patching acelerado** (priorize CVEs explorados ativamente); **desativar legados** (ex.: SMBv1).  
- **Segmenta√ß√£o de rede/VLAN**, **ACLs** e **controle de egress** (sa√≠das restritas).  
- **MFA** e pol√≠ticas de senha; **fechar RDP** √† internet (ou t√∫nel/VPN com MFA).  
- **EDR/IDS/IPS** com detec√ß√£o de varredura e explora√ß√£o; **honeypots** internos para alerta precoce.  
- **Conten√ß√£o r√°pida**: isolar host, bloquear indicadores, revogar credenciais, varrer lateralidade.  
- **Backups 3-2-1** testados e **exerc√≠cios de resposta** (tabletop + playbooks).

---

## Demos 100% Seguras para Sala (Sem Malware)

> Objetivo: ilustrar **propaga√ß√£o**, **detec√ß√£o** e **segmenta√ß√£o** sem tocar na rede real ou explorar falhas.

### 1) Simulador de Propaga√ß√£o ‚Äúem Mem√≥ria‚Äù
Demonstra o efeito cascata sem rede, apenas com ‚Äúhosts‚Äù fict√≠cios.

```python
# Simula√ß√£o did√°tica (offline): propaga√ß√£o tipo S-I em uma rede fict√≠cia.
# N√£o faz conex√µes reais. Requer Python 3.x.
import random

N = 40                      # "hosts" fict√≠cios
edges = {i:set() for i in range(N)}
# Gera "rede" aleat√≥ria e esparsa
for i in range(N):
    for j in range(i+1, N):
        if random.random() < 0.07:
            edges[i].add(j); edges[j].add(i)

infected = {0}              # ponto inicial
steps = 0
print(f"Passo {steps}: infectados={sorted(infected)}")

while True:
    steps += 1
    new_inf = set()
    for h in infected:
        for viz in edges[h]:
            # "Explorar" com chance p (representa servi√ßo vulner√°vel)
            if viz not in infected and random.random() < 0.35:
                new_inf.add(viz)
    if not new_inf:
        break
    infected |= new_inf
    print(f"Passo {steps}: +{sorted(new_inf)}  total={len(infected)}")

print("\nResumo: propaga√ß√£o terminou. Total infectado (fict√≠cio) =", len(infected))
```

Explique: cada ‚Äúaresta‚Äù representa possibilidade de alcance; a probabilidade simula ‚Äúvulner√°vel vs. corrigido‚Äù. Mostra a din√¢mica de espalhamento sem qualquer risco.

---

### 2) Logs Sint√©ticos de Varredura + Detec√ß√£o
Gere um ‚Äúlog‚Äù fict√≠cio e mostre como um SOC acharia padr√µes.

```text
2025-09-03T14:10:01 SRC=10.0.1.23 DST=10.0.1.101 DPT=445 RESULT=REFUSED
2025-09-03T14:10:01 SRC=10.0.1.23 DST=10.0.1.102 DPT=445 RESULT=REFUSED
2025-09-03T14:10:02 SRC=10.0.1.23 DST=10.0.1.103 DPT=445 RESULT=ACCEPT
2025-09-03T14:10:02 SRC=10.0.1.23 DST=10.0.1.104 DPT=3389 RESULT=REFUSED
2025-09-03T14:10:03 SRC=10.0.1.23 DST=10.0.1.105 DPT=445 RESULT=ACCEPT
```

Exerc√≠cio (conceitual): pe√ßa para os alunos contarem destinos por porta e marcarem host com padr√£o de varredura (muitos destinos/mesma porta em janela curta).

---

### 3) Segmenta√ß√£o Visual (Quadro/Slide)
Desenhe 3 VLANs (Usu√°rios/Servidores/IoT) e trace ACLs m√≠nimas (ex.: Usu√°rios ‚Üí HTTP/HTTPS de sa√≠da; IoT sem sa√≠da para internet; Admin via jump-host).  
Mensagem: redes planas aceleram worms; segmenta√ß√£o reduz o raio de explos√£o.

---

### 4) ‚ÄúAntes/Depois do Patch‚Äù (Exerc√≠cio guiado)
Crie um quadro com duas colunas:

- **Antes**: servi√ßo desatualizado exposto, pico de falhas de login, conex√µes em 445.  
- **Depois**: porta filtrada, MFA em RDP, redu√ß√£o de alertas.  

Discuss√£o: prioriza√ß√£o de patches e janela de manuten√ß√£o.

---  

# üê¥ Trojan (Cavalo de Troia) ‚Äî Vis√£o Did√°tica

## O que √©
Um **Trojan** √© um malware que **se disfar√ßa de software leg√≠timo** (instalador, plugin, ‚Äúatualizador‚Äù, crack) para que o usu√°rio **execute** o programa e, ent√£o, **instale um payload** (ex.: RAT, ladr√£o de senhas, downloader). Normalmente ele busca **persist√™ncia** e pode se comunicar com um **C2 (Command & Control)**.

---

## Ciclo de Vida (Conceitual)

- **Entrega/Engano (masquerade)**: chega por *phishing*, site de downloads, malvertising, ‚Äúatualizador‚Äù falso, app *sideloaded*.  
- **Execu√ß√£o**: o usu√°rio roda o execut√°vel/instalador acreditando ser leg√≠timo.  
- **Queda de payload**: baixa (‚Äúdownloader‚Äù) ou solta (‚Äúdropper‚Äù) componentes adicionais.  
- **Persist√™ncia & evas√£o**: cria tarefas/servi√ßos/chaves de inicializa√ß√£o; usa empacotadores e ofusca√ß√£o.  
- **Comunica√ß√£o (C2)**: tenta contatar dom√≠nios/IPs para receber comandos e exfiltrar dados.  
- **A√ß√£o**: espionagem (RAT), furto de credenciais (infostealer), movimenta√ß√£o lateral, etc.

---

## Principais Variantes (Alto N√≠vel)

- **Dropper / Downloader**: entrega/baixa outros malwares.  
- **RAT (Remote Access Trojan)**: controle remoto e espionagem.  
- **Banker / Infostealer**: roubo de credenciais, cookies, cofres.  
- **Fake Updater / Fake Installer**: imita atualiza√ß√µes/instaladores.  
- **Supply-chain / Typosquatting**: pacote depend√™ncia malicioso ou nome quase igual (ex.: `reqeusts` vs `requests`).  

---

## Vetores Comuns

- **Phishing** com anexos/links.  
- **Cracks/warez** e instaladores de proced√™ncia duvidosa.  
- **Malvertising** (an√∫ncios que levam a downloads falsos).  
- **Sideloading** de apps fora de lojas oficiais.  

---

## IoCs (Indicadores de Comprometimento)

- **Processos desconhecidos** fazendo **beaconing** (conex√µes peri√≥dicas) para **dom√≠nios rec√©m-registrados**.  
- **Servi√ßos/Tarefas agendadas** inesperados; chaves *Run*/*RunOnce* novas.  
- **Arquivos/DLLs** suspeitos lado a lado com apps leg√≠timos (busca de DLL por ordem de carga).  
- **Exfiltra√ß√£o** (tr√°fego a *pastebins*, encurtadores) e altera√ß√µes em pol√≠ticas do navegador.

---

## Mitiga√ß√£o & Resposta

- **Privil√©gios m√≠nimos** (usu√°rios sem admin); **MFA** e **Allowlisting** (AppLocker/WDAC).  
- **Bloquear software n√£o assinado** e **verificar assinaturas/hashes** de bin√°rios.  
- **EDR/XDR** com regras de **beaconing**, *child-process* suspeitos e *script-blocking*.  
- **Isolamento** r√°pido do host, revoga√ß√£o de credenciais, varredura de persist√™ncia e restaura√ß√£o a partir de **backups limpos**.

---

## Demos 100% Seguras para Sala (Sem Malware)

> Objetivo: **mostrar o conceito** de ‚ÄúTrojan‚Äù (disfarce, confian√ßa, persist√™ncia, beaconing) **sem** criar nada perigoso.

### 1) ‚ÄúInstalador‚Äù enganoso (apenas UI educativa)
Mostra como a interface poderia enganar ‚Äî **sem baixar/instalar nada**. Ao clicar, revela que seria um Trojan.

Salve como `trojan_ui_demo.html` e abra no navegador.
```html
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>[DEMO] Instalador Falso (educativo)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#0c111b;color:#e7ebf3;display:grid;place-items:center;min-height:100dvh;margin:0}
    .card{background:#141a2b;border:1px solid #26324a;border-radius:16px;padding:24px;max-width:560px;width:clamp(320px,90vw,560px);box-shadow:0 8px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 8px} .muted{color:#9fb1d1}
    button{border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;background:#4f7cff;color:#fff}
    ul{margin-top:8px}
  </style>
</head>
<body>
  <div class="card">
    <h1>Instalador do ‚ÄúSuperPlayer Pro‚Äù</h1>
    <p class="muted">*DEMONSTRA√á√ÉO DID√ÅTICA ‚Äî n√£o instala nada*</p>
    <ul>
      <li>Vers√£o: 10.4</li>
      <li>Editora: SuperSoft LLC (n√£o verificado)</li>
      <li>Tamanho: 2.1 MB</li>
    </ul>
    <button id="instalar">Instalar</button>
    <p id="nota" class="muted" style="margin-top:12px;"></p>
  </div>
  <script>
    document.getElementById('instalar').onclick = () => {
      alert("Se fosse um Trojan, este bot√£o instalaria um payload oculto (RAT/stealer) e criaria persist√™ncia.\nAqui √© apenas uma DEMO segura.");
      document.getElementById('nota').textContent =
        "Dica: verifique assinatura digital, hash, origem do download e pol√≠ticas de allowlisting.";
    };
  </script>
</body>
</html>
```

---

### 2) Verifica√ß√£o de Assinatura e Hash (defensivo)
Demonstre que bin√°rios leg√≠timos devem ter assinatura v√°lida e hash verific√°vel.

**Windows (PowerShell):**
```powershell
# Hash do arquivo
Get-FileHash "C:\caminho\para\aplicativo.exe" -Algorithm SHA256

# Assinatura Authenticode
Get-AuthenticodeSignature "C:\caminho\para\aplicativo.exe" | Format-List *
```

**macOS:**
```bash
# Hash
shasum -a 256 /caminho/Aplicativo.app/Contents/MacOS/Aplicativo

# Assinatura
codesign --verify --deep --strict --verbose=4 /caminho/Aplicativo.app
```

**Linux:**
```bash
sha256sum /caminho/aplicativo
# (Se fornecido pelo fornecedor) gpg --verify assinatura.asc aplicativo
```

Mensagem did√°tica: ‚ÄúTrojan‚Äù t√≠pico n√£o possui assinatura confi√°vel e muitas vezes vem de fonte sem cadeia de confian√ßa.

---

### 3) ‚ÄúBeaconing‚Äù offline (simula√ß√£o segura)
Simule o comportamento de conex√µes peri√≥dicas sem usar rede: o script apenas imprime que ‚Äúbeaconaria‚Äù.

Salve como `beacon_sim.py` e execute com `python beacon_sim.py`.

```python
# DEMO segura: simula "beaconing" sem rede (apenas prints)
import time, uuid, random, datetime

HOST_ID = str(uuid.uuid4())[:8]
C2 = "c2.exemplo-inofensivo.local"  # N√ÉO √© resolvido/contatado
intervalo = (5, 9)  # segundos

print(f"[start] host={HOST_ID} simulando beacon para {C2}")
for i in range(5):  # 5 ciclos apenas
    ts = datetime.datetime.now().isoformat(timespec="seconds")
    print(f"[{ts}] beacon -> {C2} (simulado) payload={{host:'{HOST_ID}', seq:{i}}}")
    time.sleep(random.randint(*intervalo))
print("[done] fim da simula√ß√£o")
```

Explique: EDR procura padr√µes peri√≥dicos e dom√≠nios recentes. Em ambiente real, bloquearia no proxy/Firewall e alertaria.

---

### 4) Invent√°rio de Persist√™ncia (somente leitura)
Liste locais t√≠picos onde Trojans tentam persistir ‚Äî sem criar nada.

**Windows (PowerShell):**
```powershell
# Tarefas agendadas
Get-ScheduledTask | Select-Object TaskName,TaskPath,State | Sort-Object TaskPath,TaskName

# Itens de inicializa√ß√£o (usu√°rio)
Get-CimInstance Win32_StartupCommand | Select-Object Name,Command,Location

# Chaves Run/RunOnce (apenas leitura)
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Run"
reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\Run"
```

**Linux:**
```bash
# Cron do usu√°rio e do sistema
crontab -l 2>/dev/null || echo "sem crontab do usu√°rio"
ls -al /etc/cron.* /etc/cron.d 2>/dev/null

# Autostart por sess√£o
ls -al ~/.config/autostart 2>/dev/null

# Servi√ßos e timers
systemctl list-timers --all
systemctl list-units --type=service --state=running
```

**macOS:**
```bash
# LaunchAgents/Daemons
ls -al ~/Library/LaunchAgents
ls -al /Library/LaunchAgents
ls -al /Library/LaunchDaemons

# Itens de login (Ventura+)
osascript -e 'tell application "System Events" to get the name of every login item'
```

Exerc√≠cio: pe√ßa aos alunos para identificar entradas desconhecidas e discutir crit√©rios de suspei√ß√£o (nome, pasta, editor, data, assinatura).

---

## Roteiro Sugerido (20‚Äì25 min)
- **Conceito & ciclo de vida** (5 min).  
- **UI do ‚Äúinstalador‚Äù falso** (3‚Äì5 min) ‚Üí refor√ßar ‚Äún√£o instale de fontes n√£o confi√°veis‚Äù.  
- **Assinatura & hash** (5‚Äì7 min) ‚Üí verifica√ß√£o pr√°tica.  
- **Beaconing offline** (3‚Äì5 min) ‚Üí como o SOC/EDR detectaria.  
- **Persist√™ncia (invent√°rio)** (3‚Äì5 min) ‚Üí onde ca√ßar IoCs.

-----

# üïµÔ∏è Spyware ‚Äî Vis√£o Did√°tica

## O que √©
**Spyware** √© um tipo de malware focado em **coletar informa√ß√µes sem consentimento** ‚Äî hist√≥rico de navega√ß√£o, cookies/sess√µes, credenciais salvas, capturas de tela, localiza√ß√£o, telemetria do dispositivo etc.  
Em geral, atua silenciosamente, priorizando **persist√™ncia** e **exfiltra√ß√£o** (envio de dados) para um servidor do atacante.

---

## Como funciona (alto n√≠vel)
- **Coleta**: l√™/copia dados sens√≠veis (cookies, ‚Äúauto-fill‚Äù, cofres do navegador), faz **screenshots**, registra eventos (p. ex., ‚Äúform-grabbing‚Äù no navegador).  
- **Persist√™ncia**: adiciona-se a **tarefas agendadas**, chaves de **Run/RunOnce**, **LaunchAgents/Daemons**, *autostart* etc.  
- **Evas√£o**: ofusca√ß√£o, *packing*, uso de processos leg√≠timos (navegador, PowerShell), tentativas de desativar AV/EDR.  
- **Exfiltra√ß√£o**: envia dados para **C2** ou servi√ßos p√∫blicos (*pastebins*, encurtadores) usando HTTP(S), DNS tunneling ou APIs.

---

## Principais variantes (alto n√≠vel)
- **Infostealer**: foca em **cookies/sess√µes**, senhas salvas, carteiras cripto.  
- **Banker**: fraudes financeiras (inje√ß√£o de p√°ginas, *overlays*).  
- **Stalkerware**: monitora localiza√ß√£o/comunica√ß√µes (geralmente em mobile).  
- **Ad/Trackingware agressivo**: coleta extensiva para an√∫ncios/perfis.  
- **Fileless**: opera em **mem√≥ria** e abusa de ferramentas leg√≠timas (PowerShell/WMI).

---

## Vetores comuns
- **Anexos maliciosos** (phishing) e downloads ‚Äúgratuitos‚Äù (*bundlers* com *adware/spyware*).  
- **Extens√µes de navegador** com permiss√µes excessivas.  
- **Sites comprometidos / malvertising** (scripts de terceiros).  
- **Software pirata** e ‚Äúatualizadores‚Äù falsos.

---

## IoCs (Indicadores de Comprometimento)
- **Extens√µes suspeitas** instaladas recentemente; permiss√µes amplas (‚ÄúLer e alterar dados de todos os sites‚Äù).  
- **Tr√°fego** para **pastebins**, encurtadores, dom√≠nios rec√©m-registrados ou picos de **exfiltra√ß√£o** fora do hor√°rio.  
- **Certificados raiz novos** (tentativa de interceptar HTTPS via *man-in-the-browser / proxy*).  
- **Mudan√ßas** em pol√≠ticas do navegador, novos **processos/tarefas** persistentes, chaves de inicializa√ß√£o.

---

## Mitiga√ß√£o & Resposta
- **Endurecer navegadores**: bloquear extens√µes n√£o aprovadas (lista de permiss√£o), desabilitar *autofill* para senhas sens√≠veis, bloquear *third-party cookies* onde poss√≠vel.  
- **Gerenciadores de senhas + MFA**: n√£o salve senhas no navegador sem pol√≠tica; prefira **cofres** e **chaves f√≠sicas/U2F**.  
- **EDR/XDR + proxy seguro**: detectar **beaconing/exfiltra√ß√£o** e bloquear dom√≠nios rec√©m-criados.  
- **Revisar certificados raiz**: remover CA n√£o autorizada; usar **pinning** em apps cr√≠ticos.  
- **Resposta**: isolar host, invalidar sess√µes, **rotacionar credenciais**, revisar perfil do navegador, remover extens√µes suspeitas, checar persist√™ncia, **li√ß√µes aprendidas**.

---

## Demos 100% Seguras para Sala (Sem Malware)

> Objetivo: **entender o conceito** de coleta e exfiltra√ß√£o **sem capturar dados reais**, sem rede e sem tocar no sistema.

### 1) Permiss√µes do navegador (Geolocaliza√ß√£o com consentimento expl√≠cito)
Mostra como um site **pode solicitar localiza√ß√£o** ‚Äî aqui s√≥ exibe na tela, **n√£o envia nada**.

Salve como `demo_geoloc.html`:
```html
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>[DEMO] Permiss√£o de geolocaliza√ß√£o (segura)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>body{font-family:system-ui;background:#0c111b;color:#e7ebf3;display:grid;place-items:center;min-height:100vh}
  .card{background:#141a2b;border:1px solid #26324a;border-radius:16px;padding:24px;max-width:540px}button{padding:10px 14px;border:0;border-radius:10px;background:#4f7cff;color:#fff;font-weight:700;cursor:pointer}</style>
</head>
<body>
  <div class="card">
    <h1>DEMO ‚Äî Solicita√ß√£o de Localiza√ß√£o</h1>
    <p>Ao clicar, o navegador pedir√° <strong>permiss√£o</strong>. O resultado aparece abaixo (nada √© enviado).</p>
    <button id="pedir">Solicitar localiza√ß√£o</button>
    <pre id="out"></pre>
  </div>
  <script>
    const out = document.getElementById('out');
    document.getElementById('pedir').onclick = async () => {
      if(!('geolocation' in navigator)) { out.textContent = 'Sem API de geolocaliza√ß√£o.'; return; }
      navigator.geolocation.getCurrentPosition(
        pos => out.textContent = JSON.stringify({
          latitude: pos.coords.latitude.toFixed(5),
          longitude: pos.coords.longitude.toFixed(5),
          precisao_m: pos.coords.accuracy
        }, null, 2),
        err => out.textContent = 'Permiss√£o negada (boa pr√°tica quando voc√™ n√£o confia no site).'
      );
    };
  </script>
</body>
</html>
```

Mensagem did√°tica: ‚ÄúPermiss√µes s√£o poderosas; conceda apenas ao que for necess√°rio e a sites confi√°veis.‚Äù

---

### 2) ‚ÄúExfiltra√ß√£o‚Äù offline (simula√ß√£o com reda√ß√£o/an√¥nimo)
Demonstra que um script poderia preparar dados para envio; aqui nada sai do navegador.
Ele anonimiza padr√µes sens√≠veis (e-mail, CPF fict√≠cio) e apenas mostra o JSON que ‚Äúseria‚Äù enviado.

Salve como `demo_exfil_offline.html`:
```html
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"><title>[DEMO] Exfiltra√ß√£o (simulada, offline)</title><meta name="viewport" content="width=device-width, initial-scale=1">
<style>body{font-family:system-ui;background:#0b1220;color:#e7eaf3;display:grid;place-items:center;min-height:100vh}
.card{background:#141b2d;border:1px solid #26324a;border-radius:16px;padding:24px;max-width:720px;width:clamp(320px,90vw,720px)}
textarea{width:100%;min-height:120px;border-radius:10px;border:1px solid #2f3d5a;background:#0f1626;color:#e7eaf3;padding:12px}
button{margin-top:12px;padding:10px 14px;border:0;border-radius:10px;background:#4f7cff;color:#fff;font-weight:700;cursor:pointer}
pre{background:#10172b;border:1px solid #26324a;border-radius:10px;padding:12px;overflow:auto}</style>
</head>
<body>
  <div class="card">
    <h1>DEMO ‚Äî Prepara√ß√£o de ‚Äúexfiltra√ß√£o‚Äù (apenas exibe, n√£o envia)</h1>
    <p>Digite dados <strong>fict√≠cios</strong> abaixo. O script <em>redige</em> e <strong>mostra</strong> o JSON que um spyware enviaria ‚Äî mas aqui fica <strong>s√≥ na tela</strong>.</p>
    <textarea id="txt" placeholder="Ex.: Meu e-mail √© joao@example.com e meu CPF √© 123.456.789-09 (fict√≠cio)."></textarea>
    <button id="prep">Preparar pacote</button>
    <pre id="out"></pre>
  </div>
<script>
function redact(s){
  const email=/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi;
  const cpf=/\b\d{3}\.?\d{3}\.?\d{3}-?\d{2}\b/g; // demonstra√ß√£o
  return s.replace(email,'<email>').replace(cpf,'<cpf>');
}
document.getElementById('prep').onclick=()=>{
  const raw=document.getElementById('txt').value;
  const red=redact(raw);
  const pacote={
    timestamp:new Date().toISOString(),
    origem:"pagina_demo_local",
    dados_anonimizados:red,
    observacao:"DEMO offline ‚Äî nenhum envio de rede ocorre aqui."
  };
  document.getElementById('out').textContent=JSON.stringify(pacote,null,2);
};
</script>
</body>
</html>
```

Mensagem did√°tica: ‚ÄúExfiltra√ß√£o √© trivial quando um script tem acesso; DLP/EDR e pol√≠ticas de conte√∫do (CSP) reduzem risco.‚Äù

---

### 3) Revis√£o de extens√µes (passo a passo ‚Äî sem c√≥digo)
Mostre aos alunos como auditar permiss√µes:

- **Chrome/Edge**: abra `chrome://extensions` / `edge://extensions` ‚Üí Detalhes ‚Üí verifique Permiss√µes (‚ÄúLer e alterar dados de todos os sites?‚Äù) e Fonte (loja oficial, editor verificado).  
- **Firefox**: `about:addons` ‚Üí Extens√µes ‚Üí Permiss√µes.  

Boas pr√°ticas: remova extens√µes que n√£o usa, desconfie de mudan√ßas recentes de editor, bloqueie por pol√≠tica em ambientes corporativos.

---

### 4) Checagem de certificados raiz (somente leitura)
Detectar CA n√£o autorizada ajuda a evitar intercepta√ß√£o do HTTPS por malware.

**Windows (PowerShell):**
```powershell
# Listar Autoridades Raiz (LocalMachine)
Get-ChildItem Cert:\LocalMachine\Root | Select-Object Subject, Thumbprint, NotBefore, NotAfter | Sort-Object Subject

# Raiz do Usu√°rio Atual
Get-ChildItem Cert:\CurrentUser\Root | Select-Object Subject, Thumbprint, NotBefore, NotAfter
```

**macOS:**
```bash
# Listar √¢ncoras do sistema
security find-certificate -a -p /System/Library/Keychains/SystemRootCertificates.keychain | openssl x509 -noout -subject -enddate | head
# Keychain do usu√°rio (inspecione no app "Acesso √†s Chaves" para ver emissores recentes)
```

**Linux (Ubuntu/Debian):**
```bash
ls -l /usr/share/ca-certificates
sudo update-ca-certificates --fresh  # (apenas para reconstruir a store, sem adicionar CAs)
```

O que observar: CAs rec√©m-adicionadas por softwares desconhecidos. Em empresas, siga o processo formal antes de remover entradas.

---

## Dicas de condu√ß√£o (defensivo)
- Reforce MFA e cofres de senha (reduzem impacto de roubo de cookies/senhas).  
- CSP/SRI: pol√≠ticas de conte√∫do e integridade de scripts limitam dano de terceiros.  
- Proxy seguro/Firewall: bloqueie dom√≠nios de exfiltra√ß√£o e dom√≠nios rec√©m-registrados.  
- Treinamento: cuidado com anexos e instaladores ‚Äúgr√°tis‚Äù; verifique assinatura digital e hash de m√≠dias.

 -----

# üì¢ Adware ‚Äî Vis√£o Did√°tica

## O que √©
**Adware** √© um software indesejado que **injeta propagandas**, altera **p√°gina inicial** e **mecanismos de busca**, cria **redirecionamentos** e, em alguns casos, atua como **porta de entrada** para outras amea√ßas (downloader).

---

## Como funciona (alto n√≠vel)
- **Instala√ß√£o oportunista:** vem ‚Äúde brinde‚Äù em **bundlers** (instaladores de freeware com ofertas pr√©-marcadas) ou extens√µes de navegador com **permiss√µes excessivas**.  
- **Altera√ß√£o do navegador:** troca **home page**, **search engine**, adiciona **extens√µes** e scripts de **inje√ß√£o de an√∫ncios**.  
- **Persist√™ncia & evas√£o:** recria tarefas/servi√ßos ap√≥s remo√ß√£o, reinjeta configura√ß√µes no perfil do navegador.  
- **Monetiza√ß√£o:** paga por **impress√µes/cliques** (√†s vezes via redes de **malvertising**).  

---

## Principais variantes (alto n√≠vel)
- **Browser hijacker:** sequestra busca e p√°gina inicial.  
- **Ad injector:** insere banners/pop-ups/overlays em sites.  
- **PUP/PUA (aplicativo potencialmente indesejado):** ‚Äúotimizadores/limpadores‚Äù que for√ßam an√∫ncios.  
- **Bundled installers:** empacotam v√°rias ‚Äúofertas‚Äù e restauram o adware ao reiniciar.

---

## Vetores comuns
- **Instaladores ‚Äúfree‚Äù/bundlers** com op√ß√µes escondidas.  
- **Sites de *warez*/cracks** e ‚Äúatualizadores‚Äù falsos.  
- **Extens√µes** de navegador pouco confi√°veis.  
- **Campanhas de malvertising** (an√∫ncios que levam a download suspeito).

---

## IoCs (Indicadores de Comprometimento)
- **Pop-ups** e **redirecionamentos** frequentes sem motivo.  
- **Home page/search engine** modificados sem consentimento.  
- **Extens√µes/servi√ßos** desconhecidos que **reaparecem** ap√≥s remo√ß√£o.  
- **Tarefas agendadas** recriando o adware; novos **par√¢metros** de inicializa√ß√£o do navegador (ex.: `--load-extension=...`).  

---

## Mitiga√ß√£o & Resposta
- **Restaura√ß√£o do navegador**: redefinir configura√ß√µes, remover **extens√µes** n√£o aprovadas, limpar **atalhos**/par√¢metros de execu√ß√£o.  
- **Bloqueio de bundlers**: **allowlisting** de software (AppLocker/WDAC) e instala√ß√£o apenas via **lojas oficiais**.  
- **Varredura antimalware/EDR** e revis√£o de **tarefas agendadas**/itens de inicializa√ß√£o.  
- **Pol√≠ticas corporativas**: cat√°logo de extens√µes permitidas, bloqueio de malvertising, educa√ß√£o do usu√°rio (‚Äúdesmarcar ofertas‚Äù).  

---

## Demos 100% Seguras para Sala (Sem Malware)

> Objetivo: mostrar **efeitos irritantes** do adware **sem instalar nada**, **sem persist√™ncia** e **sem tocar no sistema**.

### 1) ‚ÄúAdware‚Äù inofensivo (apenas nesta p√°gina)
Salve como `adware_demo.html` e abra no navegador.

```html
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<title>[DEMO DID√ÅTICA] Adware</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--bg:#0e0f13;--fg:#e9ecf1;--mut:#a8b0bf;--accent:#ff4757}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  header{padding:20px;border-bottom:1px solid #232631}
  main{padding:24px;max-width:900px;margin:0 auto}
  button{border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .banner{position:fixed;left:12px;bottom:12px;background:#ffeaa7;color:#111;padding:10px 14px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.4)}
  .ad{position:fixed;background:#1b1e2a;border:1px solid #30364a;color:#e9ecf1;border-radius:14px;box-shadow:0 16px 42px rgba(0,0,0,.5);width:280px;padding:14px}
  .ad h3{margin:0 0 6px}
  .muted{color:var(--mut)}
  .close{float:right;background:var(--accent);color:#fff;border-radius:8px;padding:4px 8px}
</style>
</head>
<body>
  <header>
    <h1>DEMO: Comportamento ‚ÄúAdware‚Äù (inofensivo)</h1>
    <p class="muted">Banners invasivos e ‚Äúaltera√ß√£o‚Äù de homepage ‚Äî <strong>apenas nesta p√°gina</strong>.</p>
  </header>

  <main>
    <div class="row">
      <button id="spawn">Gerar an√∫ncio</button>
      <button id="spawnMany">Gerar v√°rios</button>
      <button id="clearAll">Remover todos</button>
      <button id="toggleHome">Alterar ‚Äúp√°gina inicial‚Äù (falso)</button>
    </div>
    <p style="margin-top:18px;color:var(--muted)">Simula√ß√£o did√°tica ‚Äî nada √© instalado e nada persiste.</p>
  </main>

  <div class="banner" id="banner" hidden>
    ‚ÄúSua p√°gina inicial foi alterada!‚Äù (mentira t√≠pica de adware) ‚Äî <button id="undo">Desfazer</button>
  </div>

  <script>
    let count = 0;
    function createAd(x=20,y=80){
      const ad = document.createElement('div');
      ad.className = 'ad';
      ad.style.left = (x + Math.random()*40) + 'px';
      ad.style.top  = (y + Math.random()*40) + 'px';
      ad.style.zIndex = 1000 + count++;
      ad.innerHTML = `
        <button class="close" aria-label="Fechar">x</button>
        <h3>Promo√ß√£o Imperd√≠vel!</h3>
        <p class="muted">Clique aqui! Clique aqui! Clique aqui!</p>
      `;
      ad.querySelector('.close').onclick = () => ad.remove();
      ad.onmousedown = (e) => { // arrastar
        const dx = e.clientX - ad.offsetLeft, dy = e.clientY - ad.offsetTop;
        function move(ev){ad.style.left=(ev.clientX-dx)+'px';ad.style.top=(ev.clientY-dy)+'px';}
        function up(){window.removeEventListener('mousemove',move);window.removeEventListener('mouseup',up);}
        window.addEventListener('mousemove',move);window.addEventListener('mouseup',up);
      };
      document.body.appendChild(ad);
    }
    document.getElementById('spawn').onclick = ()=> createAd(40,120);
    document.getElementById('spawnMany').onclick = ()=> { for(let i=0;i<4;i++) createAd(60+i*40,140+i*30); };
    document.getElementById('clearAll').onclick = ()=> document.querySelectorAll('.ad').forEach(e=>e.remove());
    document.getElementById('toggleHome').onclick = ()=> document.getElementById('banner').hidden = false;
    document.getElementById('undo').onclick = ()=> document.getElementById('banner').hidden = true;
  </script>
</body>
</html>
```

**Pontos did√°ticos para narrar durante a demo**
- Como extens√µes/scripts poderiam injetar banners e ‚Äúfor√ßar‚Äù homepage/search.  
- Por que listas de permiss√£o (allowlist) de extens√µes e instala√ß√£o centralizada reduzem o risco.  
- Diferen√ßa entre adware (irritante/indesejado) e malvertising (an√∫ncio que leva a malware).

---

### 2) Checklist de Remedia√ß√£o (pr√°tica r√°pida)
- **Navegador**: redefinir configura√ß√µes, remover extens√µes suspeitas, revisar atalhos (par√¢metros).  
- **Sistema**: verificar tarefas agendadas/itens de inicializa√ß√£o; rodar antimalware/EDR.  
- **Pol√≠tica**: bloquear bundlers e s√≥ permitir software/lojas confi√°veis; cat√°logo de extens√µes aprovadas.

 -----

# ü™§ Rootkits ‚Äî Vis√£o Did√°tica

## O que √©
**Rootkits** s√£o conjuntos de t√©cnicas/softwares voltados a **ocultar** processos, arquivos, chaves de registro e conex√µes, garantindo **persist√™ncia** e **evas√£o** da detec√ß√£o. Podem atuar em **modo usu√°rio**, **kernel**, **boot/firmware** (UEFI) e at√© em **dispositivos** (placas/BIOS).

---

## Como funciona (alto n√≠vel)
- **Cloaking (oculta√ß√£o):** ‚Äúenganam‚Äù ferramentas do sistema (listas de arquivos/processos/drivers), interceptando chamadas de API para **n√£o mostrar** o que o atacante quer esconder.  
- **Persist√™ncia:** servi√ßos/tarefas, chaves de inicializa√ß√£o, *launch agents/daemons*, modifica√ß√£o de **boot chain** ou **firmware**.  
- **Evas√£o:** assinaturas digitais indevidas, ofusca√ß√£o, uso de drivers vulner√°veis/ileg√≠timos, desativa√ß√£o de logs/telemetria.  
- **Controle:** podem abrir backdoors, exfiltrar dados, carregar outros malwares de forma furtiva.

---

## Principais variantes (alto n√≠vel)
- **User-mode rootkit:** intercepta APIs em processos de usu√°rio (ex.: *hook* em fun√ß√µes de listagem).  
- **Kernel-mode rootkit:** carrega **driver** que altera tabelas/rotinas do kernel (oculta√ß√£o mais profunda).  
- **Bootkit/UEFI:** compromete **bootloader**/NVRAM/firmware para executar **antes** do SO.  
- **Firmware/Device rootkit:** embutido em controladoras, NIC, GPU etc. (mais raro e avan√ßado).

---

## Vetores comuns
- **Explora√ß√£o de kernel/drivers** (EoP), **drivers comprometidos** (assinados ou *bring-your-own-vulnerable-driver*).  
- **Boot adulterado** (desativar **Secure Boot**, manipular UEFI).  
- **P√≥s-explora√ß√£o** ap√≥s phishing/exploit (o rootkit √© instalado para **permanecer** e ocultar).

---

## IoCs (Indicadores de Comprometimento)
- **Diverg√™ncias de vis√£o**: ferramenta A n√£o v√™ arquivos/processos que ferramenta B v√™.  
- **Secure Boot desativado** repentinamente; logs de **Code Integrity** acusando falhas.  
- **Drivers suspeitos** carregados recentemente; mensagens de ‚Äúm√≥dulo n√£o verificado‚Äù no *kernel log*.  
- **Altera√ß√µes** de NVRAM/boot entries; pol√≠ticas do EDR desabilitadas sem justificativa.

---

## Mitiga√ß√£o & Resposta
- **Preven√ß√£o:** **Secure Boot/Measured Boot/TPM** habilitados; **allowlisting** de drivers; manter SO/firmware **atualizados**.  
- **Detec√ß√£o:** EDR/XDR com **verifica√ß√£o de integridade**, varredura fora de banda (rescue m√≠dia), compara√ß√£o de **vis√µes** (user vs. baixo n√≠vel).  
- **Resposta:** **isolar** o host, **preservar evid√™ncias** (mem√≥ria/logs), **reprovisionar** com **m√≠dia confi√°vel** (reinstala√ß√£o limpa), **rotacionar segredos**; revisar cadeia de boot/firmware.

---

## Demos 100% Seguras para Sala (Sem Malware)

> Objetivo: ilustrar **oculta√ß√£o** e **diverg√™ncia de vis√£o**, **assinatura/verifica√ß√£o de drivers** e **estado do Secure Boot**, sem tocar em kernel, boot ou firmware.

### 1) ‚ÄúCloaking‚Äù simulado (apenas no script)
Mostra a ideia de ‚Äúferramenta enganada‚Äù: um script ‚Äúlista‚Äù arquivos, mas **filtra** um nome ‚Äî e depois voc√™ compara com a listagem real do SO.

Salve como `rootkit_cloak_sim.py`:
```python
# DEMO segura: simula uma ferramenta "enganada" que oculta nomes contendo "secreto"
import os, sys
p = sys.argv[1] if len(sys.argv) > 1 else "."
real = sorted(os.listdir(p))
fake = [f for f in real if "secreto" not in f.lower()]

print("Vis√£o (ferramenta enganada):", fake)
print("Vis√£o real (SO):            ", real)
print("\nExperimente criar 'secreto.txt' e rodar novamente.")
```

**Uso:**
```bash
mkdir -p LAB_ROOTKIT && cd LAB_ROOTKIT
echo ok > normal.txt
echo oculto > secreto.txt
python3 ../rootkit_cloak_sim.py .
ls -la   # compare com a sa√≠da do script
```

Mensagem did√°tica: rootkits de verdade fazem algo an√°logo, por√©m dentro do sistema (user/kernel), enganando utilit√°rios.

---

### 2) Verificar Secure Boot (somente leitura)
**Windows (PowerShell, admin):**
```powershell
Confirm-SecureBootUEFI
# True = habilitado; False = desabilitado (ou BIOS legado)
```

**Linux:**
```bash
mokutil --sb-state     # em distros com shim/EFI
bootctl status         # em sistemas com systemd-boot
dmesg | grep -i secure # mensagens do kernel sobre Secure Boot
```

**macOS:**
- SIP (prote√ß√£o de integridade): `csrutil status` (leitura).  
- Secure Boot (Apple Silicon/T2): checado pela ‚ÄúUtilit√°rio de Seguran√ßa de Inicializa√ß√£o‚Äù no modo de recupera√ß√£o (somente verificar, n√£o alterar, em aula).

Mensagem: Boot verificado dificulta bootkits e drivers n√£o confi√°veis.

---

### 3) Invent√°rio de drivers/m√≥dulos (somente leitura)
**Windows:**
```powershell
# Listar drivers e verificar assinatura Authenticode
Get-ChildItem C:\Windows\System32\drivers\*.sys |
  Get-AuthenticodeSignature |
  Select-Object Path, Status, SignerCertificate | Format-Table -AutoSize

# Listar drivers carregados
driverquery /v /fo table
```

**Linux:**
```bash
lsmod | head
# Ver assinante de um m√≥dulo (se suportado)
modinfo -F signer <nome_do_modulo>
dmesg | egrep -i "module|taint|verif" | tail -n 50
```

**macOS (moderno):**
```bash
kmutil showloaded | head   # m√≥dulos/kexts carregados (em vers√µes recentes)
```

Mensagem: drivers n√£o assinados ou rec√©m-adicionados sem mudan√ßa planejada s√£o sinais de alerta.

---

### 4) Compara√ß√£o de ‚Äúduas vis√µes‚Äù (exerc√≠cio r√°pido)
Rode o script do item 1 para ver oculta√ß√£o simulada.  
Em seguida, use ferramentas do SO (`ls/dir`, Task Manager/Activity Monitor/`ps`) para comparar.  

Discuss√£o: por que EDR costuma fazer verifica√ß√£o fora de banda (kernel callbacks, raw reads) para confirmar?

---

## Dicas de condu√ß√£o (defensivo)
- Reforce pol√≠tica de drivers (allowlisting, atualiza√ß√£o, remo√ß√£o de legado).  
- Monitorar mudan√ßas de boot (Secure Boot, chaves MOK, UEFI updates).  
- Treinar equipe a reconhecer diverg√™ncia de vis√£o (ex.: ‚Äúminha ferramenta n√£o v√™, mas o sistema v√™‚Äù).  
- Encerrar com procedimento de erradica√ß√£o: quando suspeitar de rootkit em kernel/boot, reinstale limpo a partir de m√≠dia confi√°vel e troque credenciais.

--------

# ‚å®Ô∏è Keyloggers ‚Äî Vis√£o Did√°tica

## O que √©
**Keyloggers** s√£o ferramentas (software ou hardware) que **capturam eventos de teclado** e, √†s vezes, **dados de formul√°rios** e **telas**. O objetivo t√≠pico √© **roubar credenciais** e outras informa√ß√µes sens√≠veis. Em contexto malicioso, costumam **persistir** e **exfiltrar** dados para um servidor do atacante.

---

## Como funciona (alto n√≠vel)
- **Captura**: observa pressionamentos de teclas (**keydown/keyup**) ou l√™ campos de formul√°rio antes do envio. Variantes avan√ßadas podem **gravar tela**/clipboard.
- **Persist√™ncia** (software): tarefas agendadas, chaves de *Run*/servi√ßos, extens√µes do navegador.
- **Evas√£o**: ofusca√ß√£o, inje√ß√£o de DLL, uso de processos leg√≠timos (navegador/PowerShell).
- **Exfiltra√ß√£o**: envio peri√≥dico (‚Äú**beaconing**‚Äù) a **C2**; √†s vezes via servi√ßos p√∫blicos (*pastebins*).

---

## Principais variantes (alto n√≠vel)
- **Software (aplica√ß√£o/driver)**  
  - *In-browser/form-grabber*: scripts/ extens√µes que leem campos **dentro do navegador**.  
  - *User-mode hooks*: ‚Äúenganam‚Äù APIs de entrada em processos de usu√°rio.  
  - *Kernel drivers*: capturam no n√≠vel do sistema (maior privil√©gio).  
  - *Screen/clipboard loggers*: complementam com captura de tela/√°rea de transfer√™ncia.
- **Hardware**  
  - **Dispositivos USB inline** (entre teclado e PC).  
  - **Teclados adulterados** com mem√≥ria interna.

---

## Vetores comuns
- **Trojans/phishing** (anexos e instaladores falsos).  
- **Extens√µes de navegador** com **permiss√µes amplas**.  
- **Dispositivos USB** adulterados/‚Äúbrindes‚Äù.

---

## IoCs (Indicadores de Comprometimento)
- **DLLs injetadas** em navegadores/Apps de escrit√≥rio; bibliotecas carregadas fora do padr√£o.  
- **Tr√°fego leve e peri√≥dico** (beaconing) para dom√≠nios **rec√©m-registrados**.  
- **Extens√µes** novas com permiss√£o ‚ÄúLer e alterar dados de **todos** os sites‚Äù.  
- **Entradas de persist√™ncia** (Run/RunOnce, tarefas, *LaunchAgents/Daemons*).  
- **Conex√µes USB** incomuns (novo HID) ou adaptadores inline.

---

## Mitiga√ß√£o & Resposta
- **MFA** (chaves FIDO/U2F) e **cofres de senha** ‚Üí reduzem impacto de credenciais capturadas.  
- **Navegadores isolados**/perfis separados; **allowlisting** de extens√µes; **CSP/SRI** para scripts.  
- **EDR/XDR** com pol√≠ticas anti-inje√ß√£o, bloqueio de *hooks* suspeitos e detec√ß√£o de beaconing.  
- **Inspe√ß√£o f√≠sica** de teclados/cabos; invent√°rio de dispositivos USB.  
- **Resposta**: isolar host, **invalidar sess√µes** (SSO, e-mail, bancos), **rotacionar credenciais**, remover extens√µes/entradas de persist√™ncia e revisar logs de acesso.

---

## Demos 100% Seguras para Sala (Sem Malware)

> **Objetivo:** demonstrar o **conceito** (observa√ß√£o de teclas/formul√°rios) **sem capturar conte√∫do real**, **sem rede** e **sem persist√™ncia**.

### 1) ‚ÄúKeylogger‚Äù **anonimizado** (apenas no `<textarea>`)
*Mostra categorias de teclas (L=letra, N=n√∫mero, ‚ê£, ‚Üµ, ‚å´, ‚Ä¢) ‚Äî **n√£o** registra caracteres.*

Salve como `keylogger_demo_anon.html`:
```html
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<title>[DEMO] Keylogger ANONIMIZADO (seguro)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--bg:#0c111b;--fg:#e7ebf3;--mut:#9fb1d1;--card:#141a2b;--bord:#26324a}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;display:grid;place-items:center;min-height:100dvh}
  .card{background:var(--card);border:1px solid var(--bord);border-radius:16px;padding:24px;max-width:820px;width:clamp(320px,90vw,820px)}
  textarea{width:100%;min-height:120px;border-radius:12px;border:1px solid var(--bord);background:#0f1524;color:var(--fg);padding:12px}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0}
  button{border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  .start{background:#4f7cff;color:#fff}.stop{background:#ff5d5d;color:#fff}
  .box{border:1px solid var(--bord);border-radius:12px;padding:12px;background:#10172b}
</style>
</head>
<body>
  <div class="card">
    <h1>DEMO segura de ‚Äúkeylogger‚Äù (anonimizado)</h1>
    <p class="mut">Captura <em>apenas</em> dentro do campo e **n√£o** registra texto real nem envia dados.</p>

    <label for="pad">√Årea de teste:</label>
    <textarea id="pad" placeholder="Digite aqui..." disabled></textarea>

    <div style="margin:8px 0">
      <input type="checkbox" id="ok"><label for="ok"> Autorizo a captura <strong>anonimizada</strong> <em>somente</em> neste campo.</label>
    </div>

    <div class="row">
      <button id="start" class="start" disabled>Iniciar</button>
      <button id="stop" class="stop" disabled>Parar</button>
    </div>

    <div class="box">
      <strong>√öltimas teclas (anonimizadas)</strong>
      <div id="stream" style="min-height:24px;margin-top:6px;word-wrap:break-word"></div>
      <div id="stats" style="color:var(--mut);margin-top:8px">Total: 0 ‚Ä¢ L:0 ‚Ä¢ N:0 ‚Ä¢ ‚ê£:0 ‚Ä¢ ‚Üµ:0 ‚Ä¢ ‚å´:0 ‚Ä¢ ‚Ä¢:0</div>
    </div>
  </div>

<script>
const pad = document.getElementById('pad'), ok = document.getElementById('ok');
const startBtn = document.getElementById('start'), stopBtn = document.getElementById('stop');
const stream = document.getElementById('stream'), stats = document.getElementById('stats');

let enabled=false, counters={T:0,L:0,N:0,SP:0,EN:0,BK:0,O:0};
function cat(k){
  if(k===' ') return '‚ê£';
  if(k==='Enter') return '‚Üµ';
  if(k==='Backspace') return '‚å´';
  if(/^[a-zA-Z]$/.test(k)) return 'L';
  if(/^[0-9]$/.test(k)) return 'N';
  return '‚Ä¢';
}
function onKeydown(e){
  if(!enabled || e.target!==pad) return;      // restrito ao textarea
  const c = cat(e.key); counters.T++;
  ({'L':'L','N':'N','‚ê£':'SP','‚Üµ':'EN','‚å´':'BK','‚Ä¢':'O'})[c] && counters[{'L':'L','N':'N','‚ê£':'SP','‚Üµ':'EN','‚å´':'BK','‚Ä¢':'O'}[c]]++;
  stream.textContent = (stream.textContent + c).slice(-80);
  stats.textContent = `Total: ${counters.T} ‚Ä¢ L:${counters.L} ‚Ä¢ N:${counters.N} ‚Ä¢ ‚ê£:${counters.SP} ‚Ä¢ ‚Üµ:${counters.EN} ‚Ä¢ ‚å´:${counters.BK} ‚Ä¢ ‚Ä¢:${counters.O}`;
}
function start(){
  if(!ok.checked){ alert('Marque o consentimento.'); return; }
  enabled=true; pad.disabled=false; pad.focus();
  startBtn.disabled=true; stopBtn.disabled=false;
  window.addEventListener('keydown', onKeydown, {capture:true});
}
function stop(){
  enabled=false; startBtn.disabled=false; stopBtn.disabled=true;
  window.removeEventListener('keydown', onKeydown, {capture:true});
}
ok.addEventListener('change', ()=> startBtn.disabled=!ok.checked);
startBtn.addEventListener('click', start);
stopBtn.addEventListener('click', stop);
</script>
</body>
</html>
```

Mensagem did√°tica: scripts podem observar eventos do DOM; por isso √© vital controlar extens√µes e pol√≠ticas de conte√∫do (CSP/SRI).

---

### 2) Intercepta√ß√£o de formul√°rio sem conte√∫do (comprimento/tempo)
Demonstra que um script poderia ‚Äúver‚Äù antes do envio; aqui s√≥ mostra comprimento/tempo, sem texto nem rede.

Salve como `form_intercept_demo.html`:
```html
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/><title>[DEMO] Intercepta√ß√£o segura</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
  body{font-family:system-ui;background:#0b1220;color:#e7eaf3;display:grid;place-items:center;min-height:100vh;margin:0}
  .card{background:#141b2d;border:1px solid #26324a;border-radius:16px;padding:24px;max-width:560px;width:clamp(320px,90vw,560px)}
  input{width:100%;padding:10px 12px;border:1px solid #2f3d5a;border-radius:10px;background:#0f1626;color:#e7eaf3}
  label{display:block;margin:12px 0 6px}
  button{margin-top:14px;width:100%;padding:10px 12px;border:0;border-radius:10px;background:#4f7cff;color:#fff;font-weight:700;cursor:pointer}
  .box{border:1px solid #2f3d5a;border-radius:10px;padding:10px;margin-top:10px;background:#10172b}
</style>
</head>
<body>
  <div class="card">
    <h1>DEMO ‚Äî Formul√°rio (sem capturar texto)</h1>
    <form id="f" autocomplete="off">
      <label for="u">Usu√°rio</label><input id="u" placeholder="ex.: joao" required />
      <label for="p">Senha</label><input id="p" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
      <button type="submit">Entrar</button>
    </form>
    <div id="log" class="box" aria-live="polite"></div>
  </div>
<script>
const f=document.getElementById('f'), u=document.getElementById('u'), p=document.getElementById('p'), log=document.getElementById('log');
let t0u=null,t0p=null;
function msg(s){log.innerHTML+=s+"<br/>";}
u.addEventListener('input',()=>{ if(!t0u) t0u=performance.now(); msg(`Usu√°rio: comprimento=${u.value.length}`);});
p.addEventListener('input',()=>{ if(!t0p) t0p=performance.now(); msg(`Senha: comprimento=${p.value.length} (sem conte√∫do)`);});
f.addEventListener('submit',e=>{
  e.preventDefault();
  alert(`DEMO educativa:\n- Nenhum texto capturado.\n- Tempos aproximados: usu√°rio=${t0u? (performance.now()-t0u).toFixed(0)+'ms':'‚Äì'}; senha=${t0p? (performance.now()-t0p).toFixed(0)+'ms':'‚Äì'}.\nBoas pr√°ticas: MFA, CSP, revis√£o de extens√µes.`);
  log.innerHTML=""; f.reset(); t0u=t0p=null;
});
</script>
</body>
</html>
```

---

### 3) Checklist r√°pido de inspe√ß√£o f√≠sica (hardware)
- Verifique entre o conector USB e o PC se existe um **adaptador inline** estranho.  
- Confirme **modelo/part number** do teclado com o invent√°rio.  
- Em ambientes corporativos, **pro√≠ba perif√©ricos** n√£o inventariados e use **portas USB bloqueadas** por pol√≠tica onde fizer sentido.

---

## Dicas de condu√ß√£o (defensivo)
- Explique **limites dos demos** (sem conte√∫do real, sem rede, local).  
- Reforce que **MFA** e **tokens de hardware** neutralizam loggers que s√≥ pegam senha.  
- Mostre **pol√≠ticas de extens√µes** e **segmenta√ß√£o de perfis** (ex.: um perfil ‚Äúbanco/governo‚Äù).  
- Oriente **rota√ß√£o de senhas** e **invalida√ß√£o de sess√µes** ao menor sinal de IoC.

-----

# üö™ Backdoors ‚Äî Vis√£o Did√°tica

## O que √©
**Backdoors** s√£o acessos **ocultos** criados por invasores (ou, raramente, deixados por desenvolvedores) para **retornar ao ambiente** sem passar pelos controles normais. Podem aparecer como **contas furtivas**, **web shells**, **tarefas/servi√ßos persistentes**, **chaves SSH** n√£o autorizadas ou **modifica√ß√µes em apps/dep√™ndencias** (supply chain).

---

## Como funciona (alto n√≠vel)
- **Cria√ß√£o do acesso**: ap√≥s um comprometimento, o invasor adiciona **usu√°rios ocultos**, **chaves SSH**, **tarefas** ou **web shells**.
- **Persist√™ncia & evas√£o**: nomeia artefatos como ‚Äúatualiza√ß√£o/telemetria‚Äù, espalha em locais pouco auditados e tenta burlar logs.
- **Uso sob demanda**: o atacante volta quando quer, usando o canal ‚Äúsecreto‚Äù (HTTP(S), SSH, RDP, etc.).
- **Encadeamento**: muitas vezes acompanha **Trojan/Rootkit** ou surge via **supply chain** (pacote depend√™ncia/instalador adulterado).

---

## Variantes (alto n√≠vel)
- **Usu√°rios/Grupos furtivos** (IAM fraco, senhas padr√£o, permiss√µes amplas).  
- **Web shell** (arquivo em diret√≥rio *web* que aceita comandos) ‚Äî foco de **WAF** e integridade.  
- **SSH backdoor** (chaves n√£o autorizadas em `authorized_keys`).  
- **Backdoor em bin√°rio/depend√™ncia** (supply chain, typosquatting).  
- **Servi√ßos/Tarefas** de persist√™ncia com nomes gen√©ricos (ex.: ‚ÄúUpdateSvc‚Äù).

---

## Vetores comuns
- **Falhas de configura√ß√£o** (admin padr√£o, portas expostas, permiss√µes frouxas).  
- **P√≥s-explora√ß√£o** (ap√≥s phishing/exploit, deixam um ‚Äúretorno‚Äù).  
- **Supply chain** (instalador/pacote malicioso, depend√™ncia trocada).  

---

## IoCs (Indicadores de Comprometimento)
- **Contas novas/elevadas** inesperadas; altera√ß√µes em grupos privilegiados.  
- **Chaves SSH** **desconhecidas** em `authorized_keys`.  
- **Arquivos estranhos** no *webroot* (ex.: `.php/.aspx` com padr√µes de execu√ß√£o).  
- **Tarefas/servi√ßos** rec√©m-criados com nomes gen√©ricos; **beaconing** discreto.  
- **Integridade alterada** (hashes diferentes em bin√°rios/scripts cr√≠ticos).

---

## Mitiga√ß√£o & Resposta
- **Auditoria cont√≠nua** (IAM, chaves, servi√ßos, *webroot*, integridade de arquivos).  
- **Rota√ß√£o de credenciais/segredos** e **MFA**.  
- **WAF** e regras espec√≠ficas contra **web shells**; bloquear *upload exec*.  
- **Monitoramento de integridade** (baseline de hashes) e telemetria (EDR/XDR).  
- **Supply chain**: verifica√ß√£o de **assinaturas/hashes**, **SBOM**, reposit√≥rios confi√°veis, *allowlisting*.  
- **Resposta**: **isolar host**, remover backdoors, **corrigir falha raiz**, reconstituir a partir de **m√≠dia confi√°vel**.

---

## Demos 100% Seguras para Sala (Sem Malware)

> Objetivo: treinar **detec√ß√£o e auditoria** de backdoors usando **comandos apenas de leitura** e **simula√ß√µes locais**.  
> ‚ö†Ô∏è **N√£o** criar web shells reais, **n√£o** alterar produ√ß√£o. Fa√ßa em laborat√≥rio.

### 1) Auditoria de **contas e grupos** (somente leitura)

**Windows (PowerShell):**
```powershell
# Contas locais
Get-LocalUser | Select-Object Name,Enabled,LastLogon | Sort-Object Name

# Membros de Administrators (aten√ß√£o a entradas inesperadas)
Get-LocalGroupMember -Group "Administrators" | Select-Object Name,PrincipalSource,ObjectClass
```

**Linux:**
```bash
# Usu√°rios "humanos" (UID >= 1000 pode variar por distro)
awk -F: '$3>=1000 {printf "%-20s home=%s shell=%s\n",$1,$6,$7}' /etc/passwd | sort

# Grupos sudo/admin (ajuste para sua distro)
getent group sudo || getent group wheel
```

**macOS:**
```bash
dscl . list /Users | sort | head
dscl . read /Groups/admin GroupMembership
```

Discuss√£o: marque novas contas sem justificativa, admin indevido e lastLogon suspeito.

---

### 2) Auditoria de chaves SSH autorizadas (somente leitura)
**Linux/macOS (como root ou com permiss√£o):**
```bash
for d in /home/* /Users/*; do
  [ -d "$d/.ssh" ] || continue
  echo ">>> $d"
  ls -l "$d/.ssh"
  [ -f "$d/.ssh/authorized_keys" ] && nl -ba "$d/.ssh/authorized_keys" | sed -e 's/\(.\{80\}\).*/\1.../'
done
```

O que observar: chaves recentes sem mudan√ßa planejada, coment√°rios estranhos, hosts n√£o reconhecidos.

---

### 3) Varredura segura de webroot (padr√µes suspeitos)
Simula√ß√£o: crie uma pasta de laborat√≥rio e arquivos fict√≠cios (NUNCA em servidor real). O script s√≥ l√™ e aponta strings suspeitas.

Salve como `scan_webroot_sim.py`:
```python
# DEMO segura: procura *padr√µes* comuns de web shell (apenas leitura)
import os, re, sys
path = sys.argv[1] if len(sys.argv)>1 else "LAB_WEBROOT"
pats = [
  r"eval\s*\(", r"assert\s*\(", r"base64_decode\s*\(", r"shell_exec\s*\(",
  r"system\s*\(", r"passthru\s*\(", r"popen\s*\(", r"proc_open\s*\("
]
rx = [re.compile(p, re.I) for p in pats]
hits = 0
for root, _, files in os.walk(path):
  for f in files:
    if f.lower().endswith((".php",".asp",".aspx",".jsp",".js",".txt",".html")):
      try:
        with open(os.path.join(root,f), errors="ignore") as h:
          s = h.read()
      except Exception: 
        continue
      bad = [p.pattern for p in rx if p.search(s)]
      if bad:
        hits += 1
        print(f"[suspeito] {os.path.join(root,f)}  padr√µes={bad}")
print(f"\nResumo: {hits} arquivo(s) com padr√µes suspeitos (simula√ß√£o).")
```

**Uso:**
```bash
mkdir -p LAB_WEBROOT
printf '<?php echo "ol√°"; ?>' > LAB_WEBROOT/index.php
printf '/* simula√ß√£o: system($_GET["cmd"]); */' > LAB_WEBROOT/talvez_suspeito.txt
python3 scan_webroot_sim.py LAB_WEBROOT
```

Mensagem did√°tica: em produ√ß√£o, use WAF, varreduras CI/CD e monitor de integridade para pegar mudan√ßas/proxies de execu√ß√£o.

---

### 4) Invent√°rio de tarefas/servi√ßos (somente leitura)
**Windows (PowerShell):**
```powershell
# Tarefas agendadas (busque nomes gen√©ricos como "update", "telemetry", "helper")
Get-ScheduledTask | Select-Object TaskName,TaskPath,State | Sort-Object TaskPath,TaskName

# Servi√ßos em execu√ß√£o
Get-Service | Where-Object {$_.Status -eq "Running"} | Sort-Object DisplayName | Select-Object DisplayName,Name
```

**Linux:**
```bash
# Cron do usu√°rio e do sistema
crontab -l 2>/dev/null || echo "sem crontab do usu√°rio"
ls -al /etc/cron.* /etc/cron.d 2>/dev/null

# Servi√ßos/timers
systemctl list-timers --all
systemctl list-units --type=service --state=running
```

**macOS:**
```bash
# LaunchAgents/Daemons
ls -al ~/Library/LaunchAgents
ls -al /Library/LaunchAgents
ls -al /Library/LaunchDaemons
```

O que observar: itens recentes sem mudan√ßa planejada, script em pasta tempor√°ria, nomes gen√©ricos.

---

### 5) (Opcional) Baseline de integridade de arquivos
Gere e guarde hashes de diret√≥rios cr√≠ticos (webroot, scripts, bin√°rios).  

Compare periodicamente (mudan√ßas inesperadas ‚áí investigar).

**Windows:**
```powershell
Get-FileHash -Algorithm SHA256 -Path C:\inetpub\wwwroot -Recurse
```

**Linux:**
```bash
find /var/www -type f -print0 | xargs -0 sha256sum > baseline.sha256
```

Em produ√ß√£o, prefira ferramentas dedicadas (AIDE, Wazuh, Tripwire) e integra√ß√£o com CI/CD.

---

## Dicas de condu√ß√£o (defensivo)
- Explique que **backdoor ‚â† zero-day**: √© o atalho colocado para retorno.  
- Reforce pol√≠ticas de mudan√ßa (cada conta/servi√ßo/chave deve ter justificativa e ticket).  
- Mostre playbook de resposta: isolar, coletar artefatos, remover backdoor, corrigir causa raiz, restaurar de fonte confi√°vel e rotacionar segredos.  
- **Supply chain**: pe√ßa para a turma verificar assinatura e hash de instaladores; discutir SBOM e pinning de depend√™ncias.

---

# üîπ Ransomware

## üìå Defini√ß√£o
Ransomware √© um tipo de malware de extors√£o que **sequestra dados** via criptografia e exige **pagamento de resgate** (geralmente em criptomoedas).  

## üìå Propaga√ß√£o
- Phishing com links/arquivos maliciosos.  
- Documentos com macros.  
- Explora√ß√£o de vulnerabilidades (RDP/SMB).  
- Downloads infectados.  
- Movimento lateral na rede.  

## üìå Impactos
- Indisponibilidade de dados.  
- Paralisa√ß√£o de opera√ß√µes.  
- Perdas financeiras e multas.  
- Danos √† reputa√ß√£o.  
- Vazamento de dados (*double extortion*).  

## üìå Tipos
1. **Crypto-Ransomware:** criptografa arquivos (ex.: WannaCry).  
2. **Locker Ransomware:** bloqueia a tela, sem criptografar arquivos.  
3. **Scareware:** assusta com mensagens falsas.  
4. **Doxware/Leakware:** amea√ßa divulgar dados roubados.  
5. **Ransomware-as-a-Service (RaaS):** modelo de neg√≥cio alugado a criminosos.  
6. **Mobile Ransomware:** afeta smartphones, bloqueando PIN ou criptografando arquivos.  

## üìå Exemplos Famosos
- WannaCry, Petya/NotPetya, Locky, Ryuk.  

---

# üîπ Outros Tipos de Amea√ßas

## 1. Botnets
- **O que s√£o:** redes de dispositivos infectados controlados remotamente (zumbis).  
- **Objetivos:** DDoS, spam, distribui√ß√£o de malware, minera√ß√£o.  
- **Exemplos:** Mirai, Zeus.  
- **Defesa:** atualiza√ß√£o de IoT, troca de senhas padr√£o, monitoramento de tr√°fego.  

## 2. Scareware
- **O que √©:** simula alertas falsos de v√≠rus para for√ßar compra de softwares in√∫teis.  
- **Exemplo:** pop-ups de ‚Äúseu PC est√° infectado!‚Äù.  
- **Defesa:** antiv√≠rus leg√≠timo, n√£o clicar em links suspeitos.  

## 3. Cryptojacking
- **O que √©:** usa CPU/GPU da v√≠tima para minerar criptomoedas.  
- **Formas:** malware local ou scripts em sites.  
- **Defesa:** bloqueadores de minera√ß√£o, monitoramento de performance.  

## 4. Fileless Malware
- **O que √©:** atua somente na mem√≥ria, sem gravar arquivos no disco.  
- **Exemplo:** scripts PowerShell/WMI maliciosos.  
- **Defesa:** EDR, bloqueio de macros, princ√≠pio do menor privil√©gio.  

---

# üîπ Tipos de Ataques em Seguran√ßa

## 1. Phishing
- E-mails/mensagens falsas simulando institui√ß√µes.  
- **Objetivo:** roubo de credenciais.  
- **Defesa:** conscientiza√ß√£o, MFA, filtros.  

## 2. Spear Phishing
- Phishing direcionado a v√≠timas espec√≠ficas.  
- **Exemplo:** setor de RH.  
- **Defesa:** checagem fora do canal digital.  

## 3. Whaling
- Focado em executivos e alta gest√£o.  
- **Exemplo:** fraudes CEO fraud.  
- **Defesa:** dupla checagem em transfer√™ncias.  

## 4. Engenharia Social
- Manipula√ß√£o psicol√≥gica para obter informa√ß√µes.  
- **Exemplo:** liga√ß√£o se passando por suporte.  

## 5. Ataques de Senha
- **Brute Force, Dictionary, Credential Stuffing.**  
- **Defesa:** senhas fortes, MFA, limita√ß√£o de tentativas.  

## 6. Ataques de Rede
- **Sniffing, Spoofing, Man-in-the-Middle.**  
- **Defesa:** criptografia (HTTPS, VPN), IDS/IPS.  

## 7. DoS/DDoS
- Sobrecarga para indisponibilizar servi√ßos.  
- **Exemplo:** Mirai.  
- **Defesa:** mitiga√ß√£o em nuvem, balanceadores.  

## 8. Explora√ß√£o de Vulnerabilidades
- **Exemplo:** SMBv1 no WannaCry.  
- **Defesa:** patching, pentests.  

## 9. SQL Injection e XSS
- **SQLi:** manipula√ß√£o de banco de dados.  
- **XSS:** inje√ß√£o de scripts em sites.  
- **Defesa:** valida√ß√£o de entrada, WAF.  

## 10. Zero-Day
- Explora√ß√£o de falha ainda desconhecida.  
- **Defesa:** monitoramento comportamental, bug bounty.  

---

# üîπ Boas Pr√°ticas de Defesa

## 1. Atualiza√ß√µes e patches regulares
- **Por que:** fecham falhas conhecidas.  
- **Exemplo:** falha explorada pelo WannaCry.  

## 2. Uso de antiv√≠rus e antimalware
- **Por que:** detectam malwares conhecidos.  
- **Complemento:** EDR/XDR para an√°lise em tempo real.  

## 3. Backup frequente dos dados cr√≠ticos
- **Regra 3-2-1:** 3 c√≥pias, 2 m√≠dias, 1 offsite.  
- **Exemplo:** hospitais recuperados ap√≥s ransomware.  

## 4. Autentica√ß√£o multifator (MFA)
- **Protege mesmo com senha vazada.**  
- **Exemplo:** reduzir credential stuffing.  

## 5. Monitoramento cont√≠nuo e resposta a incidentes
- **Ferramentas:** SIEM, SOC/CSIRT, playbooks de resposta.  
- **Exemplo:** detectar tr√°fego anormal para C2.  

## 6. Treinamento de usu√°rios
- **Por que:** humanos s√£o elo fraco.  
- **Exemplo:** simula√ß√£o de phishing reduz chance de ataques em 70%.  

üëâ **Defesa em profundidade:** camadas de seguran√ßa combinando **tecnologia, processos e pessoas**.  

-------

1) Phishing (did√°tico e inofensivo)

O que mostra: como uma p√°gina falsa poderia enganar algu√©m ‚Äî sem coletar dados, sem rede, e com aviso educativo claro.

Salve como phishing_demo.html e abra no navegador.

<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>[DEMO DID√ÅTICA] Phishing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;display:grid;place-items:center;min-height:100dvh;background:#0b1220;color:#e7eaf3}
    .card{background:#141b2d;border:1px solid #26324a;border-radius:16px;padding:28px;max-width:360px;width:100%;box-shadow:0 8px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 6px;font-size:1.25rem}
    p.badge{margin:0 0 16px;color:#9fb1d1}
    label{display:block;margin:12px 0 6px}
    input{width:100%;padding:10px 12px;border:1px solid #2f3d5a;border-radius:10px;background:#0f1626;color:#e7eaf3}
    button{margin-top:16px;width:100%;padding:10px 12px;border:0;border-radius:10px;background:#4f7cff;color:#fff;font-weight:600;cursor:pointer}
    .edu{margin-top:18px;font-size:.9rem;color:#9fb1d1}
    .banner{position:fixed;inset:12px auto auto 12px;background:#ffbe0b;color:#1a1a1a;padding:6px 10px;border-radius:8px;font-weight:700}
  </style>
</head>
<body>
  <div class="banner">DEMONSTRA√á√ÉO DID√ÅTICA ‚Äî N√ÉO USE CREDENCIAIS REAIS</div>
  <div class="card" role="region" aria-label="Formul√°rio de demonstra√ß√£o">
    <h1>Entre na sua conta</h1>
    <p class="badge">*Exemplo educacional de p√°gina falsa*</p>

    <form id="demo-form" autocomplete="off">
      <label for="email">E-mail</label>
      <input id="email" type="email" placeholder="voce@exemplo.com" required />
      <label for="pwd">Senha</label>
      <input id="pwd" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
      <button type="submit">Entrar</button>
    </form>

    <div class="edu" id="edu" hidden></div>
  </div>

  <script>
    document.getElementById('demo-form').addEventListener('submit', (e) => {
      e.preventDefault();
      // N√ÉO coleta, N√ÉO envia, s√≥ educa:
      const msg = `
‚ö†Ô∏è ESTA √â UMA SIMULA√á√ÉO DE PHISHING.
Nunca insira credenciais em p√°ginas suspeitas.
Verifique o endere√ßo (URL/HTTPS), ortografia e remetente.
Habilite MFA sempre que poss√≠vel.`;
      alert(msg);
      const edu = document.getElementById('edu');
      edu.hidden = false;
      edu.textContent = "Dica: verifique a URL, cadeado HTTPS e suspeite de urg√™ncias/amea√ßas no texto.";
      (e.target).reset();
    });
  </script>
</body>
</html>

2) Adware (inofensivo ‚Äî s√≥ ‚Äúirritante‚Äù)

O que mostra: pop-ups/banners invasivos dentro da pr√≥pria p√°gina (sem persist√™ncia, sem instalar nada).

Salve como adware_demo.html.

<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>[DEMO DID√ÅTICA] Adware</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--bg:#0e0f13;--fg:#e9ecf1;--muted:#a8b0bf;--accent:#ff4757}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
    header{padding:20px;border-bottom:1px solid #232631}
    main{padding:24px;max-width:900px;margin:0 auto}
    button{border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .banner{position:fixed;left:12px;bottom:12px;background:#ffeaa7;color:#111;padding:10px 14px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.4)}
    .ad{position:fixed;background:#1b1e2a;border:1px solid #30364a;color:#e9ecf1;border-radius:14px;box-shadow:0 16px 42px rgba(0,0,0,.5);width:280px;padding:14px}
    .ad h3{margin:0 0 6px}
    .muted{color:var(--muted)}
    .close{float:right;background:var(--accent);color:#fff;border-radius:8px;padding:4px 8px}
  </style>
</head>
<body>
  <header>
    <h1>DEMO: Comportamento ‚ÄúAdware‚Äù (inofensivo)</h1>
    <p class="muted">Gera banners irritantes e overlays ‚Äî <strong>apenas nesta p√°gina</strong>.</p>
  </header>

  <main>
    <div class="row">
      <button id="spawn">Gerar an√∫ncio</button>
      <button id="spawnMany">Gerar v√°rios</button>
      <button id="clearAll">Remover todos</button>
      <button id="toggleHome">Alterar ‚Äúp√°gina inicial‚Äù (falso)</button>
    </div>
    <p style="margin-top:18px;color:var(--muted)">Isto √© apenas uma simula√ß√£o did√°tica ‚Äî n√£o altera configura√ß√µes reais.</p>
  </main>

  <div class="banner" id="banner" hidden>
    ‚ÄúSua p√°gina inicial foi alterada!‚Äù (mentira t√≠pica de adware) ‚Äî <button id="undo">Desfazer</button>
  </div>

  <script>
    let count = 0;
    function createAd(x=20,y=80){
      const ad = document.createElement('div');
      ad.className = 'ad';
      ad.style.left = (x + Math.random()*40) + 'px';
      ad.style.top  = (y + Math.random()*40) + 'px';
      ad.style.zIndex = 1000 + count++;
      ad.innerHTML = `
        <button class="close" aria-label="Fechar">x</button>
        <h3>Promo√ß√£o Imperd√≠vel!</h3>
        <p class="muted">Clique aqui! Clique aqui! Clique aqui!</p>
      `;
      ad.querySelector('.close').onclick = () => ad.remove();
      ad.onmousedown = (e) => { // arrastar
        const dx = e.clientX - ad.offsetLeft;
        const dy = e.clientY - ad.offsetTop;
        function move(ev){ad.style.left=(ev.clientX-dx)+'px';ad.style.top=(ev.clientY-dy)+'px';}
        function up(){window.removeEventListener('mousemove',move);window.removeEventListener('mouseup',up);}
        window.addEventListener('mousemove',move);window.addEventListener('mouseup',up);
      };
      document.body.appendChild(ad);
    }
    document.getElementById('spawn').onclick = ()=> createAd(40,120);
    document.getElementById('spawnMany').onclick = ()=> { for(let i=0;i<4;i++) createAd(60+i*40,140+i*30); };
    document.getElementById('clearAll').onclick = ()=> document.querySelectorAll('.ad').forEach(e=>e.remove());
    document.getElementById('toggleHome').onclick = ()=> document.getElementById('banner').hidden = false;
    document.getElementById('undo').onclick = ()=> document.getElementById('banner').hidden = true;
  </script>
</body>
</html>

3) Scareware (mensagem enganosa, mas educativa)

O que mostra: uma ‚Äútela de p√¢nico‚Äù que tenta obrigar o clique ‚Äî no nosso caso, leva a uma explica√ß√£o.

Salve como scareware_demo.html.

<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>[DEMO DID√ÅTICA] Scareware</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{margin:0;background:#0f0f10;color:#e9ecef;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .full{position:fixed;inset:0;display:grid;place-items:center;background:radial-gradient(ellipse at center,#1d1f2a 0%,#0f0f10 60%)}
    .panel{max-width:560px;background:#1e2233;border:1px solid #2f3650;padding:28px;border-radius:16px;box-shadow:0 16px 48px rgba(0,0,0,.5)}
    h1{margin:0 0 8px}
    .warn{color:#ff6b6b;font-weight:700}
    .muted{color:#aeb6c8}
    .btn{margin-top:16px;display:inline-block;background:#ff4757;color:#fff;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  </style>
</head>
<body>
  <div class="full">
    <div class="panel" role="alertdialog" aria-label="Alerta falso">
      <h1 class="warn">‚ö†Ô∏è SEU COMPUTADOR EST√Å INFECTADO!</h1>
      <p class="muted">Clique no bot√£o para ‚Äúremover todos os v√≠rus imediatamente‚Äù.</p>
      <div class="btn" id="fix">Remover agora</div>
      <p id="edu" class="muted" style="margin-top:18px;display:none"></p>
    </div>
  </div>

  <script>
    document.getElementById('fix').onclick = () => {
      const edu = document.getElementById('edu');
      edu.style.display = 'block';
      edu.textContent =
        "Isto √© uma demonstra√ß√£o de scareware. Dicas: desconfie de urg√™ncias, " +
        "erros de gram√°tica, pop-ups agressivos e pedidos de pagamento. Feche a aba e use um antiv√≠rus leg√≠timo.";
      alert("DEMO: Nunca pague por 'limpezas' que surgem do nada.");
    };
  </script>
</body>
</html>

7) Cryptojacking (simula√ß√£o leve, com bot√£o de parar)

O que mostra: como um script pode ‚Äúcomer CPU‚Äù ‚Äî sem minerar e com bot√£o de parar.

Salve como cryptojacking_demo.html.

<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>[DEMO DID√ÅTICA] Cryptojacking (simulado)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#0c111b;color:#e7ebf3;display:grid;place-items:center;min-height:100dvh}
    .card{background:#141a2b;border:1px solid #26324a;border-radius:16px;padding:28px;max-width:540px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
    button{border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .start{background:#4f7cff;color:#fff}
    .stop{background:#ff5d5d;color:#fff}
    .muted{color:#9fb1d1}
    progress{width:100%}
  </style>
</head>
<body>
  <div class="card">
    <h1>Simula√ß√£o de uso excessivo de CPU</h1>
    <p class="muted">Demonstra como scripts maliciosos podem consumir recursos.</p>
    <div style="display:flex;gap:10px;margin:12px 0">
      <button class="start" id="start">Iniciar ‚Äúminera√ß√£o‚Äù (falsa)</button>
      <button class="stop" id="stop" disabled>Parar</button>
    </div>
    <p>Opera√ß√µes por segundo (estimado): <strong id="ops">0</strong></p>
    <progress id="load" max="100" value="0"></progress>
    <p class="muted" style="margin-top:10px">Use o Gerenciador de Tarefas/Monitor de Atividade para observar a CPU.</p>
  </div>

  <script>
    let running = false, rafId = null;
    function fakeHash(n){
      // Alguma carga CPU: opera√ß√µes matem√°ticas in√∫teis
      let x = 0;
      for(let i=0;i<n;i++){ x = (x * 1664525 + 1013904223) >>> 0; }
      return x;
    }
    function loop(){
      if(!running) return;
      const start = performance.now();
      let ops = 0;
      while (performance.now() - start < 200) { // ~200ms de trabalho
        fakeHash(5000); ops++;
      }
      document.getElementById('ops').textContent = String(ops);
      document.getElementById('load').value = Math.min(100, 20 + ops);
      rafId = requestAnimationFrame(loop);
    }
    document.getElementById('start').onclick = () => {
      running = true;
      document.getElementById('start').disabled = true;
      document.getElementById('stop').disabled = false;
      loop();
    };
    document.getElementById('stop').onclick = () => {
      running = false;
      if (rafId) cancelAnimationFrame(rafId);
      document.getElementById('start').disabled = false;
      document.getElementById('stop').disabled = true;
      document.getElementById('ops').textContent = "0";
      document.getElementById('load').value = 0;
    };
  </script>
</body>
</html>

-------------

‚úÖ Op√ß√£o B ‚Äî Pasta ‚Äúprotegida por senha‚Äù com OpenSSL (sem c√≥digo)

Mesma ideia, usando tar + OpenSSL (claro e audit√°vel).

# 1) Empacotar a pasta em um .tar
tar -cvf LAB_SEGURO.tar LAB_SEGURO

# 2) Criptografar o .tar (AES-256-CBC com PBKDF2 e muitas itera√ß√µes)
openssl enc -aes-256-cbc -salt -pbkdf2 -iter 250000 -in LAB_SEGURO.tar -out LAB_SEGURO.enc

# 3) (Opcional) Validar que o .tar original continua l√° e NADA foi destru√≠do

# 4) Descriptografar depois
openssl enc -d -aes-256-cbc -pbkdf2 -iter 250000 -in LAB_SEGURO.enc -out RECUPERADO.tar

# 5) Extrair o conte√∫do recuperado
mkdir -p RECUPERADO && tar -xvf RECUPERADO.tar -C RECUPERADO


Voc√™ prova confidencialidade com senha, e tamb√©m prova reversibilidade (a ess√™ncia que voc√™ quer demonstrar em aulas sobre ransomware, sem criar malware).

‚úÖ Op√ß√£o C ‚Äî Mini-lab de criptografia em mem√≥ria (Python, AES-GCM)

Cifra/decifra apenas texto na RAM (sem ler/gravar arquivos). Mostra sal, nonce, PBKDF2 e AEAD.

Instale a depend√™ncia:

pip install cryptography


Salve como crypto_lab_memoria.py e execute:

import os, json, base64
from typing import Tuple
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
from cryptography.hazmat.primitives.ciphers.aead import AESGCM

def b64e(b: bytes) -> str: return base64.b64encode(b).decode("utf-8")
def b64d(s: str) -> bytes: return base64.b64decode(s.encode("utf-8"))

def derivar_chave(senha: str, sal: bytes) -> bytes:
    kdf = PBKDF2HMAC(
        algorithm=hashes.SHA256(),
        length=32,
        salt=sal,
        iterations=300_000,
    )
    return kdf.derive(senha.encode())

def cifrar_texto(plaintext: str, senha: str) -> str:
    sal = os.urandom(16)      # protege contra ataques de tabela
    chave = derivar_chave(senha, sal)
    aesgcm = AESGCM(chave)
    nonce = os.urandom(12)    # necess√°rio para AES-GCM (√∫nico por mensagem)
    ct = aesgcm.encrypt(nonce, plaintext.encode(), None)
    pacote = {"salt": b64e(sal), "nonce": b64e(nonce), "ct": b64e(ct)}
    return json.dumps(pacote, indent=2, ensure_ascii=False)

def decifrar_texto(pacote_json: str, senha: str) -> str:
    d = json.loads(pacote_json)
    sal, nonce, ct = b64d(d["salt"]), b64d(d["nonce"]), b64d(d["ct"])
    chave = derivar_chave(senha, sal)
    aesgcm = AESGCM(chave)
    plaintext = aesgcm.decrypt(nonce, ct, None)
    return plaintext.decode()

if __name__ == "__main__":
    senha = "SenhaDidatica123!"
    texto = "Este √© o conte√∫do do arquivo EXEMPLO.TXT (simulado em mem√≥ria)."

    print(">>> CIFRANDO em mem√≥ria...")
    pacote = cifrar_texto(texto, senha)
    print(pacote)

    print("\n>>> DECIFRANDO em mem√≥ria...")
    recuperado = decifrar_texto(pacote, senha)
    print(recuperado)


O que voc√™ ensina com isso (sem tocar em disco):

PBKDF2 + sal (deriva√ß√£o de chave a partir de senha).

AES-GCM (criptografia autenticada: confidencialidade + integridade).

Nonce √∫nico por mensagem.

Reversibilidade controlada pela senha.

Por que seguir assim?

Voc√™ mostra exatamente o que quer (dados protegidos por senha e recupera√ß√£o) sem criar ou distribuir c√≥digo que possa ser adaptado para mal√≠cia.

Ferramentas como 7-Zip/OpenSSL s√£o comuns, auditadas e seguras para demonstra√ß√£o.

O mini-lab Python foca no conceito cripto (o que importa em aula quando se fala de ransomware).

----------

‚úÖ Keylogger ‚Äì Laborat√≥rio seguro (did√°tico, sem risco)
Como funciona este lab

S√≥ funciona dentro da pr√≥pria p√°gina e apenas quando voc√™ clica em ‚ÄúIniciar demo‚Äù e marca um checkbox de consentimento.

Ele n√£o registra os caracteres reais; em vez disso, anonimiza:

Letras ‚Üí L, d√≠gitos ‚Üí N, espa√ßo ‚Üí ‚ê£, enter ‚Üí ‚Üµ, backspace ‚Üí ‚å´, outros ‚Üí ‚Ä¢.

Nada √© salvo em disco ou enviado para a rede.

1) ‚ÄúKeylogger‚Äù anonimizado (em um <textarea> controlado)

Salve como keylogger_demo_anon.html e abra no navegador.

<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>[DEMO DID√ÅTICA] Keylogger ANONIMIZADO (seguro)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--bg:#0c111b;--fg:#e7ebf3;--muted:#9fb1d1;--card:#141a2b;--bord:#26324a;--accent:#4f7cff;--danger:#ff5d5d}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;display:grid;place-items:center;min-height:100dvh}
    .card{background:var(--card);border:1px solid var(--bord);border-radius:16px;padding:24px;max-width:820px;width:clamp(320px,90vw,820px);box-shadow:0 8px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 8px}
    p.muted{color:var(--muted);margin:0 0 16px}
    textarea{width:100%;min-height:120px;border-radius:12px;border:1px solid var(--bord);background:#0f1524;color:var(--fg);padding:12px}
    .row{display:flex;flex-wrap:wrap;gap:10px;margin:12px 0}
    button{border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .start{background:var(--accent);color:#fff}
    .stop{background:var(--danger);color:#fff}
    .ghost{background:transparent;border:1px solid var(--bord);color:var(--fg)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:12px}
    .box{border:1px solid var(--bord);border-radius:12px;padding:12px;background:#10172b}
    code{background:#0b1120;border:1px solid #1e293b;padding:2px 6px;border-radius:6px}
    .consent{display:flex;gap:8px;align-items:center;margin-top:6px}
  </style>
</head>
<body>
  <div class="card">
    <h1>DEMO segura de ‚Äúkeylogger‚Äù (anonimizado)</h1>
    <p class="muted">Interceta <em>apenas</em> as teclas dentro do campo abaixo, <strong>sem</strong> registrar caracteres reais e <strong>sem rede</strong>.</p>

    <label for="pad">√Årea de teste (digite aqui):</label>
    <textarea id="pad" placeholder="Digite aqui para ver a captura ANONIMIZADA..." disabled></textarea>

    <div class="consent">
      <input type="checkbox" id="ok" />
      <label for="ok">Autorizo a captura <strong>apenas neste campo</strong> e de forma <strong>anonimizada</strong>.</label>
    </div>

    <div class="row">
      <button id="start" class="start" disabled>Iniciar demo</button>
      <button id="stop" class="stop" disabled>Parar</button>
      <button id="reset" class="ghost">Limpar m√©tricas</button>
    </div>

    <div class="grid">
      <div class="box">
        <h3 style="margin:0 0 8px">√öltimas teclas (anonimizadas)</h3>
        <div id="stream" style="font-size:1.1rem;word-wrap:break-word;min-height:24px"></div>
      </div>
      <div class="box">
        <h3 style="margin:0 0 8px">M√©tricas</h3>
        <div id="stats" class="muted">
          Total: <code>0</code> ‚Ä¢ Letras(L): <code>0</code> ‚Ä¢ D√≠gitos(N): <code>0</code> ‚Ä¢ Espa√ßos(‚ê£): <code>0</code> ‚Ä¢ Enter(‚Üµ): <code>0</code> ‚Ä¢ Backspace(‚å´): <code>0</code> ‚Ä¢ Outros(‚Ä¢): <code>0</code><br/>
          Tempo m√©dio entre teclas: <code>‚Äì</code> ms
        </div>
      </div>
    </div>

    <p class="muted" style="margin-top:12px">
      üîé Objetivo did√°tico: mostrar que <code>addEventListener('keydown')</code> consegue observar o ato de digitar. Em ataques reais,
      o script malicioso <em>exfiltra</em> as teclas ‚Äî aqui isso <strong>n√£o ocorre</strong> (sem rede).
    </p>
  </div>

  <script>
    const pad = document.getElementById('pad');
    const ok = document.getElementById('ok');
    const startBtn = document.getElementById('start');
    const stopBtn = document.getElementById('stop');
    const resetBtn = document.getElementById('reset');
    const stream = document.getElementById('stream');
    const stats = document.getElementById('stats');

    let enabled = false;
    let counters = { total:0, L:0, N:0, SP:0, EN:0, BK:0, O:0 };
    let lastTs = null, intervals = [];

    function classifica(e){
      if(e.key === ' ') return '‚ê£';
      if(e.key === 'Enter') return '‚Üµ';
      if(e.key === 'Backspace') return '‚å´';
      if(/^[a-zA-Z]$/.test(e.key)) return 'L';
      if(/^[0-9]$/.test(e.key)) return 'N';
      return '‚Ä¢';
    }

    function onKeydown(e){
      if(!enabled) return;
      const cat = classifica(e);
      counters.total++;
      if(cat==='L') counters.L++;
      else if(cat==='N') counters.N++;
      else if(cat==='‚ê£') counters.SP++;
      else if(cat==='‚Üµ') counters.EN++;
      else if(cat==='‚å´') counters.BK++;
      else counters.O++;

      // fluxo anonimizado (√∫ltimos 80 s√≠mbolos)
      stream.textContent = (stream.textContent + cat).slice(-80);

      const now = performance.now();
      if(lastTs !== null) intervals.push(now - lastTs);
      lastTs = now;

      const avg = intervals.length ? (intervals.reduce((a,b)=>a+b,0)/intervals.length).toFixed(1) : '‚Äì';
      stats.innerHTML = `Total: <code>${counters.total}</code> ‚Ä¢ Letras(L): <code>${counters.L}</code> ‚Ä¢ D√≠gitos(N): <code>${counters.N}</code> ‚Ä¢ Espa√ßos(‚ê£): <code>${counters.SP}</code> ‚Ä¢ Enter(‚Üµ): <code>${counters.EN}</code> ‚Ä¢ Backspace(‚å´): <code>${counters.BK}</code> ‚Ä¢ Outros(‚Ä¢): <code>${counters.O}</code><br/>Tempo m√©dio entre teclas: <code>${avg}</code> ms`;
    }

    function start(){
      if(!ok.checked) { alert('Marque o consentimento para iniciar.'); return; }
      enabled = true;
      pad.disabled = false;
      pad.focus();
      startBtn.disabled = true;
      stopBtn.disabled = false;
      window.addEventListener('keydown', onKeydown, { capture:true });
    }
    function stop(){
      enabled = false;
      startBtn.disabled = false;
      stopBtn.disabled = true;
      window.removeEventListener('keydown', onKeydown, { capture:true });
    }
    function reset(){
      counters = { total:0, L:0, N:0, SP:0, EN:0, BK:0, O:0 };
      intervals = []; lastTs = null; stream.textContent = '';
      stats.innerHTML = `Total: <code>0</code> ‚Ä¢ Letras(L): <code>0</code> ‚Ä¢ D√≠gitos(N): <code>0</code> ‚Ä¢ Espa√ßos(‚ê£): <code>0</code> ‚Ä¢ Enter(‚Üµ): <code>0</code> ‚Ä¢ Backspace(‚å´): <code>0</code> ‚Ä¢ Outros(‚Ä¢): <code>0</code><br/>Tempo m√©dio entre teclas: <code>‚Äì</code> ms`;
    }

    ok.addEventListener('change', ()=> startBtn.disabled = !ok.checked);
    startBtn.addEventListener('click', start);
    stopBtn.addEventListener('click', stop);
    resetBtn.addEventListener('click', reset);
  </script>
</body>
</html>


O que mostrar em aula

Explique que um script pode observar eventos no DOM.

Reforce que o demo n√£o guarda caracteres, s√≥ categorias e tempos.

Mostre por que MFA reduz impacto e por que extens√µes e scripts de terceiros devem ser controlados.

2) Intercepta√ß√£o de formul√°rio (seguro, sem caracteres)

Mostra que um script poderia observar a digita√ß√£o antes do envio, mas aqui somente registra comprimento e tempo de digita√ß√£o ‚Äî nunca os caracteres.

Salve como form_intercept_demo.html.

<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <title>[DEMO] Intercepta√ß√£o de formul√°rio (sem capturar texto)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#0b1220;color:#e7eaf3;display:grid;place-items:center;min-height:100dvh;margin:0}
    .card{background:#141b2d;border:1px solid #26324a;border-radius:16px;padding:24px;max-width:560px;width:clamp(320px,90vw,560px);box-shadow:0 8px 30px rgba(0,0,0,.35)}
    input{width:100%;padding:10px 12px;border:1px solid #2f3d5a;border-radius:10px;background:#0f1626;color:#e7eaf3}
    label{display:block;margin:12px 0 6px}
    button{margin-top:14px;width:100%;padding:10px 12px;border:0;border-radius:10px;background:#4f7cff;color:#fff;font-weight:700;cursor:pointer}
    .muted{color:#9fb1d1}
    .box{border:1px solid #2f3d5a;border-radius:10px;padding:10px;margin-top:10px;background:#10172b}
  </style>
</head>
<body>
  <div class="card">
    <h1>Intercepta√ß√£o de Formul√°rio (DEMO segura)</h1>
    <p class="muted">Mostra comprimento e tempos ‚Äî <strong>nunca</strong> os caracteres.</p>
    <form id="f" autocomplete="off">
      <label for="u">Usu√°rio</label>
      <input id="u" name="u" placeholder="ex.: joao" required />
      <label for="p">Senha</label>
      <input id="p" name="p" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
      <button type="submit">Entrar</button>
    </form>
    <div class="box" id="log" aria-live="polite"></div>
  </div>

  <script>
    const f = document.getElementById('f');
    const u = document.getElementById('u');
    const p = document.getElementById('p');
    const log = document.getElementById('log');
    let startU=null, startP=null;

    function now(){return performance.now();}
    function write(msg){log.innerHTML += msg + "<br/>";}

    u.addEventListener('input', e=>{
      if(startU===null) startU = now();
      write(`Usu√°rio: comprimento=${u.value.length}`);
    });
    p.addEventListener('input', e=>{
      if(startP===null) startP = now();
      write(`Senha: comprimento=${p.value.length} (n√£o capturamos o conte√∫do)`);
    });

    f.addEventListener('submit', e=>{
      e.preventDefault();
      const tU = startU? (now()-startU).toFixed(0)+' ms' : '‚Äì';
      const tP = startP? (now()-startP).toFixed(0)+' ms' : '‚Äì';
      alert(
        "DEMO educativa:\n" +
        "- Scripts podem observar eventos antes do envio.\n" +
        "- Aqui, s√≥ mostramos comprimentos e tempos (sem conte√∫do).\n" +
        `- Tempo digita√ß√£o Usu√°rio: ${tU}\n` +
        `- Tempo digita√ß√£o Senha: ${tP}\n\n` +
        "Boas pr√°ticas: MFA, CSP, limitar scripts de terceiros, revisar extens√µes."
      );
      log.innerHTML = "";
      f.reset(); startU = startP = null;
    });
  </script>
</body>
</html>

Dicas de condu√ß√£o (defensivo)

Explique limites do demo: n√£o √© global, n√£o persiste, n√£o envia.

Mostre como extens√µes e scripts externos podem abusar do mesmo mecanismo ‚Üí pol√≠tica de extens√µes, CSP e verifica√ß√£o de integridade de scripts (SRI).

Reforce MFA, EDR/anti-tamper, e revis√£o de permiss√µes (acessibilidade, teclado, leitura de tela).
